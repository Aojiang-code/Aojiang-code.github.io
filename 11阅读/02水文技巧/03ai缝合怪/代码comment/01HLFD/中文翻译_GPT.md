**摘要**  
在现实场景中，由于一系列图像退化现象，获取高质量、清晰的内容照片变得具有挑战性。尽管在合成高质量图像方面取得了显著进展，之前的图像修复和增强方法往往忽视了不同退化特征。它们对各种类型的退化应用相同的结构，导致修复结果不尽如人意。受到高/低频信息适用于不同退化的启发，我们提出了HLNet，这是一种基于高低频分解的图像修复和增强方法。具体而言，我们使用两个模块进行特征提取：共享权重模块和非共享权重模块。在共享权重模块中，我们使用SCConv从不同退化中提取共同特征。在非共享权重模块中，我们引入了高低频分解块（HLFDB），该模块采用不同的方法处理高低频信息，使模型能够更有效地应对不同的退化。与其他网络相比，我们的方法考虑了不同退化的特征，从而实现了更高质量的图像修复。
**1. 引言**  
在现实场景中，各种图像退化的存在使得捕获高质量、清晰的内容照片变得具有挑战性。低曝光可能导致噪声增加，尤其在暗部，可能造成细节损失。类似地，高曝光图像中的亮部可能因过度曝光而失去细节。尽管已经提出了众多单图像修复方法，如去噪[1, 5, 17, 28, 51, 53]、去模糊[7, 32, 36, 40, 51]、超分辨率[10, 26, 29]和高动态范围图像重建[15, 25]，但其性能受到单幅图像信息不足的限制。由于单图像修复和增强的局限性，如信息不足和曝光时间影响，越来越多的方法开始利用多帧进行修复。爆破图像修复方法[13, 14]使用多个连续帧进行超分辨率和去噪，而多曝光HDR成像[22, 30, 37, 38, 45–50]则从不同曝光的LDR图像重建HDR图像。然而，这些方法仅考虑单一退化场景，忽略了其他退化情况。近年来，TMRNet[55]在统一图像修复和增强任务的框架设计中提出了可行的解决方案。它以多曝光图像为输入，逐步将非参考帧与参考帧混合。尽管他们考虑了不同退化的共性和特性问题，但在处理不同退化特征时，使用相同结构的共享权重模块和非共享权重模块，忽视了一些不同退化的特性。

为了解决上述问题，我们提出了HLNet，它考虑了各种退化的特性。与TMRNet类似，我们的模型利用共享权重模块和非共享权重模块提取特征。在共享权重模块中，我们引入了空间通道增强块（SCEB），该模块利用SCConv同时考虑空间和通道信息，有效提取不同退化的共同特征。在非共享权重模块中，不同的退化适合用不同频率的信息进行处理。例如，去噪和去模糊通常需要增强高频信息以恢复图像细节和纹理，超分辨率需要在恢复低频信息的基础上添加高频细节，而HDR重建则需要从不同帧中捕获低频信息。因此，我们提出了高低频分解块（HLFDB）。

具体而言，在HLFDB中，高频特征能够捕获详细的局部信息，更适合去噪和去模糊增强。因此，我们通过多个卷积块提取局部特征图，并通过密集连接机制在多个帧之间增强高频细节。低频特征能够捕获图像中大部分结构信息和全局特征，更适合超分辨率和多曝光HDR重建任务。因此，我们采用多级通道自注意力学习长距离依赖关系，并利用基于小波变换的规模化特征融合方法，避免由于下采样造成的结构信息丢失。因此，我们的模型在图像修复和增强中充分考虑了不同退化的特性，从而在统一的图像修复和增强任务中实现更好的性能。主要贡献总结如下：

- 我们提出了SCEB，利用SCConv同时考虑空间和通道信息，有效提取不同退化的共同特征。
- 我们提出了HLFDB，充分考虑了不同退化需要不同的高低频信息，有效解决了同时修复这些退化的挑战。
- HLNet在指标和视觉质量上超越了之前的最先进（SOTA）模型，在括号图像修复和增强挑战的第二轨道中获得了第四名。
**2. 相关工作**  

**爆破图像修复**  
爆破图像是指在短时间内快速连续捕获的一系列图像。在这一系列图像中，可能会有微小的变化，如相机移动、物体运动或光照条件的变化。爆破图像修复通常涉及几个主要类别：去噪、去模糊和超分辨率。许多专注于去噪的方法在文献中得到了广泛研究[16, 18, 19, 33, 35, 43, 44]。某些方法使用递归完全卷积深度神经网络[16]，而其他一些则选择空间变化的核估计[33, 35, 43, 44]。值得注意的是，在[18]中，还利用了偏移估计来应对由于显著物体运动而带来的挑战。在[19]中，提出了一种两阶段训练方案，依次在补丁级别和像素级别对齐，以实现图像帧之间的稳健对齐。

一些方法探索了爆破图像超分辨率的潜力[2, 12, 34, 42]。两者[42]和[34]都采用了变换器架构；然而，[42]通过省略逐像素对齐而有所不同，而选择了一种基于结构几何的简单单应性对齐。[12]的核心概念围绕生成一组伪爆破特征，顺畅地融合来自所有输入爆破帧的互补信息，以实现有效的信息交换。

**多帧HDR修复**  
多帧HDR修复涉及从多个低动态范围（LDR）帧创建高动态范围（HDR）图像。在经典的HDR修复方法中，Debevec等[9]首次提出了将多个LDR图像合并为单个HDR图像的想法。随后，许多方法采用了将其他帧对齐到参考帧的方式，包括光流、能量优化、秩最小化等。Zhang和Cham[54]使用图像梯度重新校准运动区域权重。Bogoni[4]计算了用于对齐的流向量。Sen等[39]采用基于补丁的能量最小化方法优化后续对齐和重建。然而，当面临前景物体的显著运动或在过度曝光或曝光不足区域的过多像素损失时，这些方法表现不佳。

随着深度学习的发展，深度方法也被应用于多帧HDR融合领域。an等[45]提出了一种注意力引导的图像融合方法，减少了鬼影伪影的出现。SCTNet[41]利用空间注意力和通道注意力模块，旨在同时利用动态和静态上下文信息以更好地生成图像。然而，这些方法只能处理单独的退化图像。
**3. 提出的方法**  

在本研究中，受到多曝光图像协同潜力和高低频信息适用于不同退化的启发，我们提出了一种通过高低频分解合成和增强图像的方法。目标是实现清晰、高动态范围和高分辨率的图像。具体而言，我们的输入由五幅不同曝光的原始图像组成，记作{R1, R2, R3, R4, R5}，然后进行处理。

最初，我们输入的多曝光图像数量为5，并将曝光时间为∆ti的原始图像标记为Yi，其中i ∈ {1, 2, ..., 5}且∆ti < ∆ti+1。随后，遵循多曝光HDR重建方法[20, 45, 47, 49]建立的指导方针，我们通过连接将gamma变换后的图像Yr与原始图像Yi合并，得到Fi，其中i ∈ {1, 2, ..., 5}。这个过程可以表示如下：

Yi =  
\[
\frac{R_i}{\Delta t_i/\Delta t_1}
\]

,  
Yr =  
\[
\left(\frac{R_i}{\Delta t_i/\Delta t_1}\right)^\gamma
\]  
(1)  
Fi = Concat(Yi, Yr)  
(2)  

其中，γ表示gamma校正参数，通常设置为1/2。最后，我们将这些连接的图像输入到HLNet模型中。得到的图像记作ˆH，该过程可以表示为：

ˆH = f(F1, F2, F3, F4, F5; θ)  
(3)  
其中，f(·)表示成像函数，θ指的是网络的参数。

**3.1. HLNet概述**  
我们模型的主要框架如图2所示。首先进行特征对齐，受到TMRNet的启发，利用共享权重模块和非共享权重模块进行特征提取。最后，进行上采样以获得更大尺寸的图像。

在特征对齐阶段，我们选择五幅输入图像中的第一幅作为参考帧，并使用光流[3]将其他帧的特征扭曲对齐到参考帧。然后，进一步使用可变形卷积网络（DCN）[8]对特征进行对齐。

在特征提取阶段，我们同时利用共享权重模块和非共享权重模块。这是因为在爆破和视频修复任务中，多幅输入帧中的某些退化类型通常是相似的。因此，我们在这里采用共享权重模块。共享权重不仅增强了模型的泛化能力，使其能够学习更通用的特征表示，还减少了模型的参数数量。相比之下，在TMRNet中，仅使用了常规卷积，没有充分考虑图像细节和上下文信息。因此，我们引入了空间-通道增强块（SCEB），采用SCConv同时考虑空间和通道信息，从而有效捕获图像细节和上下文信息。此外，仅依靠共享权重模块是不够的，因为其他退化是变化的。例如，存在曝光时间和图像模糊的差异。因此，我们引入了高低频分解块（HLFDB），以学习不同退化类型的特异性。该块显式地分离特征的高频和低频信息，并根据其特性以不同方式处理它们。

在这一阶段，每个对齐的帧图像Fi（其中i ∈ {1, 2, ..., 5}）依次输入网络。每帧图像首先通过一个共享权重模块，然后经过一个非共享权重模块。同时，在输入每帧图像的同时，我们还输入参考帧Fb(F1)和通过非共享权重模块得到的前一帧输出。这个过程可以用以下公式表示：

Fi+1out = HLFDB(SCEB(Concat(Fi+1, Fb, Fiout))),  
(4)  

Fi+1out表示第(i + 1)个非共享权重模块的输出。SCEB(·)表示通过空间-通道增强块后的特征图，而HLFDB(·)表示通过高低频分解块后的特征图。

在最后阶段，获得的特征图被上采样，以将低分辨率图像或特征图映射到高分辨率。这一过程通过跳跃连接、特征融合和多次上采样操作实现。

**3.2. 空间-通道增强块**  
在空间-通道增强块中，我们利用SCConv[27]，这是一个在卷积操作中整合空间和通道维度的模块，使得更有效地捕获图像细节和上下文信息，从而促进不同退化中共同特征的提取。在我们的模块中，我们在常规卷积和SCConv之间交替使用，增强了残差连接。这是因为常规卷积专注于捕获局部空间特征，有效提取图像的纹理和形状信息。同时，SCConv考虑空间和通道信息之间的关系，使得对上下文信息和通道间依赖关系有更全面的理解。通过交替使用这两者，我们确保模型不仅提取强大的局部特征，还理解它们在全局上下文中的重要性，从而实现更丰富的特征表示。这个过程可以用以下公式表示：

Fout = F + SCConv(Conv(SCConv(Conv(F)))),  
(5)  

其中，Fout表示空间-通道增强块的输出，Conv(·)表示3 × 3卷积，SCConv(·)表示空间-通道卷积。
提取这两种信息的特征。这个过程可以用以下公式表示：

Flow = Avgpool(F),  
(6)  
F ′ = Upsampling(Flow), Fhigh = F − F ′,  
(7)  

其中，Avgpool(·)表示平均池化，Upsampling(·)表示双线性插值上采样。Flow表示分离出的低频信息，而Fhigh表示分离出的高频信息。

由于高频信息代表图像的细节，我们需要采用更小的感受野，以更好地关注局部图像信息，从而实现更精细的细节修复。为了解决高频信息，我们提出了局部特征提取块，用于特征提取，由多个小卷积核的卷积和密集连接组成。小卷积核能够更好地聚焦于细节区域，而残差连接则擅长于探索高频信息[11, 24]。因此，这种组合在提取高频信息方面非常有效。

对于图像的低频信息，它有助于恢复图像的背景和轮廓。鉴于背景和轮廓信息在图像中占据相当大的比例，具有长距离依赖关系对它们的恢复是有益的。因此，如图4所示，我们引入了全局特征提取块。在该模块中，我们采用多尺度特征融合以考虑长距离交互，并在特征学习过程中利用变换器（Transformer）建立全局上下文关系。受到[52]的启发，这里实现的变换器架构放弃了空间自注意力，转而采用通道自注意力。这是因为空间自注意力会带来不可接受的计算负担。

此外，尽管多尺度特征提取能够实现长距离依赖关系，但在下采样过程中可能会丢失结构信息。受到小波变换在图像中建模尺度信息能力的启发[21]，我们提出了多尺度小波融合块，用于多尺度信息融合。离散小波变换将大尺度特征信息分离为{HH, HL, LH, LL}。我们首先将原始的小尺度信息与LL融合，然后使用逆离散小波变换将合并的信息与{HH, HL, LH}进行融合。这种方法有助于避免在直接上采样小尺度特征图并将其与大尺度特征图合并时丢失结构信息。总体而言，全局特征提取块对输入特征进行三次下采样，在不同大小的特征图上应用通道自注意力，最后利用多尺度小波融合块合并不同尺度的特征。
**3.4. 训练损失**  
在色调映射图像上训练网络比直接在HDR域中训练更为有效，因为HDR图像通常在色调映射后显示。当接收到HDR图像H时，我们通过μ-律变换压缩图像的范围。

T(H) = \(\frac{\log(1 + μH)}{\log(1 + μ)}\)  
(8)  

其中，μ表示指定压缩程度的参数，而T(H)表示色调映射后的图像。在本研究中，我们将H的值限制在[0, 1]区间，并将μ固定为5000。

L1 = \(\|T(H) - T(\hat{H})\|_1\)  
(9)  

其中，\(\hat{H}\)表示从我们的HLNet模型得出的预测结果，而H表示真实值。在此方法中，我们利用L1损失函数计算损失。

**4. 实验**  
**4.1. 实验设置**  
**数据集。**我们使用的数据集是来自括号图像修复和增强挑战的训练集——轨道2 BracketIRE+任务。该数据通过Zhang提出的仿真过程获得[55]。数据集包含来自35个场景的共1,335对数据。每对数据包括两种不同尺寸的输入，×2和×4，我们的任务利用×4大小。每个输入由五帧不同曝光的原始图像组成，尺寸为(4, 135, 240)。在此数据集中，使用了来自31个场景的1,045对数据进行训练，而剩余的290对数据则保留用于测试。

**评估指标。**我们使用两个客观度量进行定量比较：PSNR-μ和SSIM-μ，μ表示这些指标是在色调映射域中计算的。

**实施细节。**在训练过程中，多次下采样操作和小输入图像尺寸可能影响训练效果。我们将图像裁剪为64×64的大小，步幅为32，确保经过多次下采样步骤后的特征尺寸足以进行有效的特征提取。我们利用PyTorch框架，采用AdamW优化器，β1 = 0.9，β2 = 0.999。训练在一台A100 GPU上进行，使用BrackIRE+任务提供的合成数据集，总共训练200个epochs，训练时间为6天。

**4.2. 与最先进方法的比较**  
为了验证我们模型的优越性，我们将其与三种HDR重建模型、两种超分辨率模型和一种统一图像修复与增强模型进行了比较。这些模型的任务与我们的任务密切相关。HDR重建模型包括AHDRNet[45]、CA-ViT[30]和Kim[23]，它们使用多个LDR帧重建HDR图像，类似于我们的任务。超分辨率模型XRestormer[6]和ESRT[31]目前是表现最佳的超分辨率模型。统一图像修复与增强方法的模型TMRNet[55]与我们的任务一致。为了消除参数差异的影响，我们将这六种方法的模型参数设置为大致相同。

对于三种HDR重建方法，我们仅改变输入图像的数量，模型使用其原始对齐和特征提取方法，最后添加上采样以提高图像分辨率。对于两种超分辨率方法，我们仅在特征融合阶段使用其特征融合方法，对齐方法和上采样与我们的模型一致。

如表1所示，我们的方法在PSNR-μ方面领先第二名0.55 dB。总体而言，如图5(a)所示，我们的方法修复的图像在视觉效果上是最好的。在细节恢复方面，我们的模型优于其他模型，有效恢复了原始形状，而其他模型则表现出明显的模糊。在图5(b)中，我们的方法在细节恢复方面仍然表现最佳。我们可以观察到我们图像中耳朵的丰富细节，而其他方法修复的耳朵则显得模糊。此外，ESRT的结果也值得称道，因为其采用了高低频分解方法，尽管稍逊于我们模型的表现。在图5(c)中，只有我们的方法在棍子的边缘细节上没有出现模糊，而其他所有方法都有模糊现象。

**4.3. 消融研究**  
为了验证我们模型中每个组件的有效性，我们在轨道2 BracketIRE+任务数据集上进行了消融实验。我们设计了四个不同的消融实验，以评估不同组件的重要性，包括：(1) 移除空间-通道增强块(SCEB)并用简单的残差块替代；(2) 移除高低频分解块(HLFDB)并用简单的残差块替代；(3) 修改高低频信息的处理方法；(4) 修改高低频信息的分解方法。因此，总共生成了6个不同的模型。模型的具体细节将在下面详细说明，消融实验的结果如表2所示。

- **模型1：** 在共享权重模块中，我们用简单的残差块替代了SCEB模块，该模型命名为HLNet-NoSCEB。
- **模型2：** 在非共享权重模块中，我们用简单的残差块替代了HLFDB模块，该模型命名为HLNet-NoHLFDB。
- **模型3：** 在HLFDB模块中，处理高低频信息时，使用局部特征提取块处理两者，该模型命名为HLNet-LL。
- **模型4：** 在HLFDB模块中，处理高低频信息时，使用全局特征提取块处理两者，该模型命名为HLNet-GG。
- **模型5：** 在HLFDB模块中，处理高低频信息时，使用ESRT中处理高低频信息的方法来处理高频特征和低频特征，该模型命名为HLNet-ESRT。
- **模型6：** 在HLFDB模块中，使用小波变换方法替代之前的平均池化方法分解高低频信息，该模型命名为HLNet-Wavelet。

**没有空间-通道增强块。** 为了验证空间-通道增强块的有效性，我们将其替换为常规的残差块。根据表2，我们观察到PSNR-μ指标下降了0.25 dB。基于这个结果，我们得出结论，SCConv通过考虑空间和通道信息之间的关系，能够捕获更全面的上下文信息和通道间的依赖关系。捕获上下文信息和通道依赖关系的能力对于提取不同频率信息中的共同特征是非常有益的。

**使用小波变换分解高低频信息。** 为了验证使用平均池化分解高低频信息的有效性，我们进行了一个使用小波变换分解高低频信息的实验。从表2可以看出，尽管使用小波变换分解高低频信息的方法没有使用平均池化分解效果好。这是因为小波变换在选择不当的小波基函数时，可能导致图像中重要细节的丢失，从而影响最终图像质量。

**4.4. NTIRE 2024挑战的结果**  
我们参加了在NTIRE2024举行的括号图像修复与增强挑战——轨道2 BracketIRE+任务，并获得了第四名。结果如表3所示。我们的PSNR得分比基线模型TMRNet高0.75 dB。

**5. 结论**  
在本文中，我们提出了一种称为HLNet的方法，基于高低频分解用于括号图像修复和增强。通常，图像修复需要低频信息，而图像增强需要高频信息。因此，为了统一解决不同退化问题，我们提出了一种基于高低频分解的方法，能够同时提供退化图像所需的高频和低频信息。
