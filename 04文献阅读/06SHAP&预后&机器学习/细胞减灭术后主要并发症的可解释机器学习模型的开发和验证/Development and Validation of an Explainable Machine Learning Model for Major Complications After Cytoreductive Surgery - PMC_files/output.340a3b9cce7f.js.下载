(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.ctxp=f()}})(function(){var define,module,exports;return(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){(function(global){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CitationTextBlock=void 0;var _jquery=_interopRequireDefault((typeof window!=="undefined"?window['jQuery']:typeof global!=="undefined"?global['jQuery']:null));var _loadingIndicators=require("core/loading-indicators");var _copyButton=require("core/copy-button");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
var CitationTextBlock=function(){function CitationTextBlock(container){_classCallCheck(this,CitationTextBlock);this.container=container;this.textBlockContainer=this.container.find('.citation-text-block');this.selector=this.textBlockContainer.find('.citation-style-selector');this.citationTextNode=this.textBlockContainer.find('.citation-text');this.selectedStyle=null;this.copyButton=new _copyButton.CopyButton({container:this.container,trigger:this.textBlockContainer.find('.copy-button'),target:this.citationTextNode,message:'Citation successfully copied.'});this.loadingIndicator=new _loadingIndicators.DotsLoadingIndicator({container:this.textBlockContainer,className:'citation-loading-indicator'});this.initCitationFormatSelector();}
_createClass(CitationTextBlock,[{key:"initCitationTextNode",value:function initCitationTextNode(trigger){this.allCitationsUrl=(0,_jquery.default)(trigger).data('all-citations-url');var defaultStyle=(0,_jquery.default)(trigger).data('citation-style');this.textBlockContainer.find('.export-button').attr('href',(0,_jquery.default)(trigger).data('download-format-link'));var style=this.selectedStyle?this.selectedStyle:defaultStyle;this.selector.val(style.toUpperCase());this.loadCitation(style);}},{key:"initCitationFormatSelector",value:function initCitationFormatSelector(){var _this=this;this.selector.on('change',function(){_this.selectedStyle=_this.selector.find('option:selected').data('style-url-name');_this.citationTextNode.data('citation-style',_this.selectedStyle);_this.loadCitation(_this.selectedStyle);_this.container.trigger('change-event',['info','change',_this.selectedStyle]);});}},{key:"loadCitation",value:function loadCitation(style){var _this2=this;this.textBlockContainer.addClass('loading');this.loadingIndicator.show();CitationTextBlock.dataController.getCitationText(style,this.allCitationsUrl).done(function(citationText){_this2.updateCitationTextNode(citationText);_this2.copyButton.focus();}).fail(function(message){_this2.container.trigger('load-event',['error','load','Citation text block failed to load']);_this2.updateCitationTextNode(message,true);});}},{key:"updateCitationTextNode",value:function updateCitationTextNode(citationText){var disable=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this.textBlockContainer.removeClass('loading');this.loadingIndicator.hide();this.citationTextNode.html(citationText.format);this.copyButton.disable(disable);this.container.trigger('update-event',['info','update',citationText.format]);}}]);return CitationTextBlock;}();exports.CitationTextBlock=CitationTextBlock;CitationTextBlock.dataController={citationsLoaded:{},citations:{},getCitationText:function getCitationText(selectedStyle,allCitationsUrl){var _this3=this;var dfd=_jquery.default.Deferred();if(this.citationsLoaded[allCitationsUrl]){return dfd.resolve(this.getStyle(this.citations[allCitationsUrl],selectedStyle)).promise();}
_jquery.default.get(allCitationsUrl).done(function(citationsJson){_this3.citations[allCitationsUrl]=citationsJson;_this3.citationsLoaded[allCitationsUrl]=true;dfd.resolve(_this3.getStyle(citationsJson,selectedStyle)).promise();}).fail(function(){dfd.reject('Loading of citation failed.');});return dfd.promise();},getStyle:function getStyle(citations,selectedStyle){return citations[selectedStyle.toLowerCase()];}};}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"core/copy-button":3,"core/loading-indicators":4}],2:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CiteBox=void 0;var _citationTextBlock=require("./citation-text-block");var _overlayBlock=require("core/overlay-block");function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
var CiteBox=function(){function CiteBox(container,trigger){_classCallCheck(this,CiteBox);this.container=container;this.trigger=trigger;this.init();}
_createClass(CiteBox,[{key:"init",value:function init(){if(!this.container[0]||!this.trigger[0]){return;}
var citationTextBlock=new _citationTextBlock.CitationTextBlock(this.container);this.trigger.on('click',function(e){citationTextBlock.initCitationTextNode(e.currentTarget);});this.citationDialog=new _overlayBlock.OverlayBlock({container:this.container,triggers:this.trigger,cssClass:'citation-dialog-overlay'});}}]);return CiteBox;}();exports.CiteBox=CiteBox;},{"./citation-text-block":1,"core/overlay-block":5}],3:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.CopyButton=void 0;function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
var CopyButton=function(){function CopyButton(_ref){var trigger=_ref.trigger,target=_ref.target,message=_ref.message,container=_ref.container;_classCallCheck(this,CopyButton);this.container=container;this.trigger=trigger;this.target=target;this.message=message;this.initCopyButton();}
_createClass(CopyButton,[{key:"initCopyButton",value:function initCopyButton(){var _this=this;this.trigger.on('click',function(){return _this.tryCopy();});}},{key:"tryCopy",value:function tryCopy(){var copied=false;var errorLevel='warning';try{this.selectTargetValue();copied=document.execCommand('copy');window.getSelection().removeAllRanges();}catch(e){errorLevel='error';}
if(copied){this.container.trigger('copy-event',['info','copy',this.message]);}else{this.container.trigger('copy-event',[errorLevel,'copy','Can\'t copy citation. Please select text and press Ctrl+C.']);}}},{key:"selectTargetValue",value:function selectTargetValue(){if(this.target[0].nodeName==='DIV'){var range=document.createRange();range.selectNodeContents(this.target[0]);var sel=window.getSelection();sel.removeAllRanges();sel.addRange(range);}else if(this.target[0].nodeName==='INPUT'){this.target.focus().select();}}},{key:"disable",value:function disable(disableOrEnable){this.trigger.prop('disabled',disableOrEnable).toggleClass('disabled',disableOrEnable);}},{key:"focus",value:function focus(){this.trigger.focus();}}]);return CopyButton;}();exports.CopyButton=CopyButton;},{}],4:[function(require,module,exports){(function(global){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.DotsLoadingIndicator=void 0;var _jquery=_interopRequireDefault((typeof window!=="undefined"?window['jQuery']:typeof global!=="undefined"?global['jQuery']:null));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
var DotsLoadingIndicator=function(){function DotsLoadingIndicator(_ref){var template=_ref.template,container=_ref.container,before=_ref.before,after=_ref.after,width=_ref.width,height=_ref.height,color=_ref.color,className=_ref.className,_ref$activeClassName=_ref.activeClassName,activeClassName=_ref$activeClassName===void 0?'active':_ref$activeClassName;_classCallCheck(this,DotsLoadingIndicator);this.template=template||"<div class=\"dots-loading-indicator\">\n        <div class=\"dot dot-1\"></div>\n        <div class=\"dot dot-2\"></div>\n        <div class=\"dot dot-3\"></div>\n      </div>";if(container){this.el=(0,_jquery.default)(this.template).appendTo(container);}else if(before){this.el=(0,_jquery.default)(this.template).insertBefore(before);}else if(after){this.el=(0,_jquery.default)(this.template).insertAfter(after);}else{throw new Error('Please, specify "container", "before" or "after" in config');}
this.el.width(width).height(height).addClass(className);this.el.children().width(height).height(height).css('background-color',color);this.activeClassName=activeClassName;}
_createClass(DotsLoadingIndicator,[{key:"show",value:function show(){this.el.addClass(this.activeClassName);}},{key:"hide",value:function hide(){this.el.removeClass(this.activeClassName);}},{key:"destroy",value:function destroy(){this.el.remove();}}]);return DotsLoadingIndicator;}();exports.DotsLoadingIndicator=DotsLoadingIndicator;}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}],5:[function(require,module,exports){(function(global){(function(){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.OverlayBlock=void 0;var _jquery=_interopRequireDefault((typeof window!=="undefined"?window['jQuery']:typeof global!=="undefined"?global['jQuery']:null));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}
function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}
function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor;}
var OverlayBlock=function(){function OverlayBlock(_ref){var container=_ref.container,cssClass=_ref.cssClass,triggers=_ref.triggers;_classCallCheck(this,OverlayBlock);this.overlay=(0,_jquery.default)(container).parent();this.overlay.addClass(cssClass);this.container=(0,_jquery.default)(container).attr('role','document');this.triggers=triggers;this.initTriggers();this.initAppearance();this.initCloseButton();this.trapFocus(this.container);}
_createClass(OverlayBlock,[{key:"initTriggers",value:function initTriggers(){var _this=this;if(!this.triggers||!this.triggers.length){return;}
this.triggers.on('click',function(e){e.preventDefault();_this.activeTrigger=(0,_jquery.default)(e.target).closest(_this.triggers);_this.show();});}},{key:"initAppearance",value:function initAppearance(){var _this2=this;this.overlay.on('click',function(e){if(!(0,_jquery.default)(e.target).closest(_this2.container)[0]){_this2.hide();}});this.overlay.on('click','.close-overlay',function(e){e.preventDefault();_this2.hide();});this.overlay.on('keypress',function(e){if(e.key.toLowerCase()==='escape'){_this2.hide();}});(0,_jquery.default)(window).on('resize',function(){return _this2.checkContainerHeight();});}},{key:"initCloseButton",value:function initCloseButton(){this.overlay.find('.close-overlay').attr('data-pinger-ignore','true');}},{key:"trapFocus",value:function trapFocus(element){var focusableEls=(0,_jquery.default)(element[0]).find('a:visible, button:visible, textarea, input[type="text"], '+'input[type="radio"], input[type="checkbox"], select');var firstFocusableEl=focusableEls[0];var lastFocusableEl=focusableEls[focusableEls.length-1];(0,_jquery.default)(element[0]).keydown(function(e){if(!(e.key.toLowerCase()==='tab')){return;}
if(e.shiftKey){if(document.activeElement===firstFocusableEl){lastFocusableEl.focus();e.preventDefault();}}else{if(document.activeElement===lastFocusableEl){firstFocusableEl.focus();e.preventDefault();}}});}},{key:"checkContainerHeight",value:function checkContainerHeight(){if(this.container.outerHeight()>(0,_jquery.default)(window).height()){this.container.addClass('long');}else{this.container.removeClass('long');}}},{key:"show",value:function show(){this.overlay.scrollTop(0).addClass('active');this.checkContainerHeight();OverlayBlock.controller.activate(this);this.container.trigger('overlay-active');var dialogFocusElement=this.container.find('.dialog-focus');if(dialogFocusElement.length){dialogFocusElement.focus();}}},{key:"hide",value:function hide(){this.overlay.removeClass('active');OverlayBlock.controller.deactivate(this);if(this.activeTrigger){this.activeTrigger.focus();this.activeTrigger=null;}
this.overlay.trigger('overlay-hide-called');}}]);return OverlayBlock;}();exports.OverlayBlock=OverlayBlock;OverlayBlock.controller={activeBlocks:[],startIndex:10,init:function init(){var _this3=this;this.pageContainer=(0,_jquery.default)('body');this.fakeScrollEl=(0,_jquery.default)('<div class="fake-body-scroll">').appendTo(this.pageContainer);(0,_jquery.default)(window).on('keydown',function(e){if(e.key.toLowerCase()==='escape'){var lastIndex=_this3.activeBlocks.length-1;if(lastIndex!==-1){_this3.activeBlocks[lastIndex].hide();}}});},activate:function activate(block){var i=this.activeBlocks.indexOf(block);if(i!==-1){this.activeBlocks.splice(i,1);this.rearrange();}
this.activeBlocks.push(block);block.overlay.css('z-index',this.startIndex+this.activeBlocks.length);if(this.activeBlocks.length===1){this.disableContainerScroll();}},deactivate:function deactivate(block){var i=this.activeBlocks.indexOf(block);if(i!==-1){this.activeBlocks.splice(i,1);this.rearrange();}
if(!this.activeBlocks.length){this.enableContainerScroll();}},rearrange:function rearrange(){var _this4=this;this.activeBlocks.forEach(function(block,i){return block.overlay.css('z-index',_this4.startIndex+i+1);});},enableContainerScroll:function enableContainerScroll(){this.pageContainer.removeClass('no-scroll');},disableContainerScroll:function disableContainerScroll(){this.pageContainer.addClass('no-scroll');}};OverlayBlock.controller.init();}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{}]},{},[2])(2)});;