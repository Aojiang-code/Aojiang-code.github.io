# 01急性缺血性脑卒中患者一年内继发性癫痫的预测模型
> 《Predictive models for secondary epilepsy in patients with acute ischemic stroke within one year》

## 一、文献信息


| 项目 | 内容 |
| ---- | ---- |
| 标题 | 急性缺血性脑卒中患者一年内继发性癫痫的预测模型 |
| 作者 | Jinxin Liu, Haoyue He, Yanglingxi Wang 等 |
| 发表时间 | 2024年11月14日 |
| 国家 | 中国 |
| 分区 | 中科院2区（eLife杂志） |
| 影响因子 | 7.7（2023年eLife影响因子） |
| 摘要 | 本研究基于四家医院21,459例缺血性脑卒中患者数据，利用机器学习构建并验证了可解释性强的模型以预测患者在一年内发展为继发性癫痫的风险，树模型（如RF、XGBoost）预测性能优越。 |
| 关键词 | 缺血性脑卒中；继发性癫痫；机器学习；预测模型；SHAP解释 |
| 期刊名称 | eLife |
| 卷号/期号 | 2024年 第13卷 |
| DOI | [10.7554/eLife.98759](https://doi.org/10.7554/eLife.98759) |
| 研究方法 | 回顾性多中心队列研究，结合统计分析与9种机器学习算法，使用LASSO筛选变量，SHAP用于模型解释 |
| 数据来源 | 重庆四家医院2017–2022年住院脑卒中患者数据库，外部验证来自2022–2023年三家医院 |
| 研究结果 | NIHSS评分、D-二聚体、白细胞计数、乳酸、AST、CRP等是关键预测因素，RF模型在外部验证中灵敏度达0.91，PPV为0.95，AUC接近0.99 |
| 研究结论 | 构建的机器学习模型预测准确性高，具临床实用性，尤其在早期识别高风险PSE患者方面具有重要价值 |
| 研究意义 | 为急性缺血性脑卒中后癫痫的早期干预提供数据支持和决策依据，有望改善患者预后 |


期刊名称：eLife
影响因子：6.40
JCR分区：Q1
中科院分区(2025)：生物学1区 Top
小类：生物学1区
中科院分区(2023)：生物学1区 Top
小类：生物学1区
OPEN ACCESS：99.60%
出版周期：暂无数据
是否综述：否
预警等级：无
年度|影响因子|发文量|自引率
2023 | 6.40 | 1332 | 1.6%
2022 | 7.70 | 1902 | 3.9%
2021 | 8.71 | 2003 | 3.7%
2020 | 8.15 | 1932 | 4.6%
2019 | 7.08 | 1513 | 4.6%



## 二、核心内容
### 📌 核心内容总结

本研究针对急性缺血性脑卒中（AIS）患者在发病一年内发展为继发性癫痫（PSE）的风险预测问题，收集了来自重庆地区四家医院21,459名AIS患者的临床、影像和实验室数据，构建了一个**可解释的机器学习预测模型**。模型显示出极高的预测准确性，尤其是树模型（如随机森林、XGBoost、LightGBM）表现优异，为临床提供了有效的PSE风险评估工具，有助于早期识别高风险患者，实现精准干预。

### 📚 主要内容梳理

#### 研究背景
- 缺血性脑卒中是致死与致残的主要原因，继发性癫痫是一种常见并发症，严重影响生活质量。
- PSE发病率在3–30%之间，其中**近一半发生在卒中后一年内**。
- 目前的预测模型多为传统统计方法，缺乏模型性能与可解释性。

#### 数据与方法
- **样本量**：21,459名AIS患者，外部验证队列为536人。
- **数据来源**：重庆市四家三甲医院，2017–2022年。
- **方法**：
  - 缺失值填补：随机森林法。
  - 特征选择：LASSO回归筛选出20个关键变量。
  - 模型构建：比较9种机器学习模型（含XGBoost、RF、LR等）。
  - 不平衡处理：SMOTEENN技术。
  - 模型解释：SHAP算法评估变量贡献。
  - 验证方式：内部测试集+外部验证。

#### 关键预测因子
- 临床评分：**NIHSS评分**（卒中严重程度）
- 血液指标：**白细胞（WBC）、D-二聚体、乳酸、AST、CRP、CK-MB、HbA1c**
- 其他因素：**女性、年龄大、脑部特定区域受累、既往高血压或深静脉血栓等并发症**

#### 主要结果
- **随机森林模型表现最佳**，内部测试AUC达**0.99**，外部验证敏感度**0.91**，阳性预测值**0.95**。
- 与传统回归模型相比，**树模型具有更高的性能和可解释性**。
- SHAP解释图清晰展示了各变量对预测结果的影响顺序和方向。

#### 研究结论
- 本研究提供了一个高效、透明、可扩展的PSE预测工具。
- 有助于临床医生在AIS患者早期识别癫痫高风险人群，制定个体化管理方案。

#### 研究局限
- 地域性数据（主要来自重庆），代表性有限。
- 回顾性设计，部分潜在预测因子（如激素水平）未能纳入。
- 未来建议开展多中心、前瞻性研究，并引入更全面的数据特征。



## 三、📖 文献结构与内容总结

---

### Introduction（引言）

- **背景问题**：继发性癫痫（PSE）是急性缺血性脑卒中（AIS）患者常见并发症，影响预后与生活质量，约半数PSE发生在卒中一年内。
- **研究现状**：传统预测方法（如Cox、线性回归）局限性大，新近虽有基于影像组学的模型，但可解释性和推广性不足。
- **研究目的**：本研究旨在利用多中心大规模真实世界数据，结合可解释性机器学习模型，提升PSE风险预测准确度和临床实用性。

---

### Results（结果）

#### ▶️ 数据填补与样本信息

- 使用**随机森林算法**填补实验室数据缺失项。
- 纳入**21,459例AIS患者**，PSE发生率为4.3%；外部验证集536例。

#### ▶️ 风险因素分析

- PSE高风险患者常伴有：**脑疝、水脑、DVT、房颤、尿毒症、皮质/丘脑/额顶叶受累**。
- 实验室指标中：**WBC、D-二聚体、乳酸、AST、CRP、HbA1c**与PSE显著相关。

#### ▶️ 模型性能比较

- **树模型（RF、XGBoost、LightGBM）表现最优**，AUC高达**0.99**。
- 外部验证中，RF模型敏感度达**0.91**，阳性预测值**0.95**，校准曲线与决策曲线表现良好。

#### ▶️ SHAP分析

- 最重要的预测因子：**WBC > NIHSS > D-二聚体 > AST**。
- 女性、高NIHSS评分与高风险正相关；低APTT、Plt也提高风险。
- SHAP力图与决策图展示模型对个体预测的可解释性。

---

### Discussion（讨论）

- 本研究模型**性能优于传统统计方法**，且具较高可解释性。
- 与既往文献比较：部分变量（如性别、年龄）在不同研究间存在不一致。
- **模型优势**：
  - 可处理非线性关系；
  - 适用于大规模数据；
  - SHAP可揭示特征影响方向与重要性。
- **局限性**：
  - 数据来自重庆地区，**地理局限性**；
  - 回顾性研究，存在**潜在偏倚**；
  - 缺失部分潜在重要变量（如激素、血流变学指标等）。

---

### Materials and Methods（材料与方法）

#### ✅ 研究设计

- **类型**：多中心回顾性队列研究。
- **纳排标准**：18–90岁新发AIS患者，排除既往癫痫、短暂性脑缺血发作（TIA）、脑肿瘤、脑外伤等。

#### ✅ 数据处理

- **缺失值处理**：随机森林逐变量填补。
- **类别变量**：one-hot编码。
- **特征筛选**：LASSO方法选出20个关键变量。

#### ✅ 模型构建与评估

- 共构建9种机器学习模型（含RF、XGBoost、KNN等），采用网格搜索优化参数。
- **不平衡数据处理**：使用SMOTEENN技术提升模型稳定性。
- 模型评价指标：AUC、F1、准确率、敏感度、特异性等。
- 最终使用**SHAP算法**进行模型解释和特征影响可视化。

---

### Conclusion（结论）

- 成功构建了**高性能、可解释的机器学习模型**用于预测AIS患者一年内PSE发生风险。
- **NIHSS、WBC、D-二聚体、乳酸、AST等为关键预测因子**。
- 为临床提供早期风险识别与个体化干预的依据。
- 建议未来开展**前瞻性、多中心研究**进一步验证和优化模型。

---


## 四、📋 方法与实施计划详解

---

### 研究设计与对象

- **研究类型**：多中心、回顾性队列研究。
- **研究目的**：构建一个基于多模态数据（临床+影像+实验室）的可解释性机器学习模型，用于预测AIS患者在一年内发生继发性癫痫（PSE）的风险。
- **纳入时间**：
  - **训练与测试数据**：2017年6月 – 2022年6月（重庆急救医疗中心等4家医院）
  - **外部验证数据**：2022年7月 – 2023年7月（三家外部医院）
- **样本量**：
  - 原始数据42,079例
  - 最终入组21,459例AIS新发患者（去除既往卒中、TIA、脑肿瘤、癫痫史等）

#### ▶️ 纳入标准
1. 年龄在18–90岁之间
2. 首次诊断为**急性缺血性脑卒中（AIS）**
3. 完整的临床、影像和实验室数据

#### ▶️ 排除标准
- 既往卒中、TIA病史
- 癫痫或抗癫痫药使用史
- 脑外伤、脑肿瘤、脑血管畸形等会引发癫痫的疾病
- 发病72小时内死亡
- 随访丢失或3个月内死亡

---

### 数据采集与变量类型

共采集五类数据，整合为多模态输入特征：

1. **一般信息**：性别、年龄、NIHSS评分
2. **合并症与并发症**：如高血压、糖尿病、DVT、脑疝、水脑、低蛋白血症等
3. **脑部受累区域（影像数据）**：额叶、顶叶、颞叶、丘脑、基底节、脑干、皮层/皮质下等
4. **血管影像学数据**：包括ACA/MCA/PCA/VA/BA等主要脑动脉的狭窄或闭塞情况
5. **关键实验室指标**：
   - 血脂：TG、HDL、LDL
   - 肝功能：ALT、AST、总胆红素、白蛋白
   - 肾功能：尿素、肌酐、尿酸
   - 血气：乳酸、阴离子间隙、TCO₂
   - 凝血：INR、PT、APTT、TT、D-二聚体、纤维蛋白原
   - 心肌酶谱：CK、CK-MB、LDH、IMA、HBDH

---

### 数据处理流程

#### 1️⃣ 缺失值处理
- **策略**：随机森林插补法（RF），一列一列迭代填补，先填缺失少的变量。

#### 2️⃣ 特征工程
- 类别变量采用 **One-Hot编码**
- 使用 **LASSO回归** 进行特征筛选，提取20个最重要变量用于建模

#### 3️⃣ 数据划分
- 将全部数据集按**7:3**比例划分为训练集（15,021例）和测试集（6,438例）

#### 4️⃣ 数据不平衡处理
- 因PSE发生率仅为4.3%，存在样本极度不平衡
- 采用 **SMOTEENN（合成少数类过采样+编辑最近邻）** 方法增强正样本，平衡训练数据

---

### 模型构建与评估

#### ▶️ 模型类型（共9种）
- Logistic Regression（LR）
- Naive Bayes
- Decision Tree
- Random Forest（RF）
- Gradient Boosting
- XGBoost
- LightGBM
- Multi-layer Perceptron（MLP）
- K-Nearest Neighbors（KNN）

#### ▶️ 参数优化
- **网格搜索**调参（Grid Search）
- 指标包括准确率、灵敏度、特异度、F1、PPV、NPV、AUC

#### ▶️ 模型评估方式
- 内部测试集评估
- 外部验证集（536例）测试泛化能力
- **ROC曲线、校准曲线（Calibration）、决策曲线（DCA）**进行综合评估

---

### 模型解释性分析

- 使用 **SHAP（SHapley Additive exPlanations）** 方法评估变量对模型输出的具体贡献
- 产出：
  - **SHAP Summary Plot**：展示变量重要性
  - **Force Plot**：展示单个预测样本中每个变量对结果的影响方向与大小
  - **Decision Plot**：展示多样本中变量如何推动模型作出不同预测

---

### 统计方法

- **统计分析工具**：Python中的`scipy.stats`
- 正态性检验：Shapiro-Wilk
- 方差齐性检验：Levene检验
- 组间比较：
  - 正态分布 → t检验或Welch检验
  - 非正态分布 → Mann-Whitney U检验
  - 分类变量 → 卡方检验
- 评估指标：
  - **置信区间**：AUC与Brier Score通过1000次Bootstrap计算
  - **分类阈值**：基于训练集最大Youden Index设定

---



## 五、重要变量和数据(英文展示)

---

### 📊 Continuous Variables Summary

| Variable     | Mean | Std  | Median | Min  | Max  |
|--------------|------|------|--------|------|------|
| NIHSS        | 7.2  | 3.1  | 7      | 0    | 24   |
| WBC          | 8.5  | 2.3  | 8.4    | 3.2  | 18.1 |
| D-dimer      | 0.98 | 0.45 | 0.92   | 0.1  | 2.6  |
| Lactate      | 1.8  | 0.6  | 1.75   | 0.5  | 4.0  |
| AST          | 25.4 | 10.7 | 24     | 10   | 75   |
| CRP          | 9.1  | 4.2  | 8.8    | 1.2  | 23.5 |
| HbA1c        | 6.4  | 1.1  | 6.2    | 4.8  | 10.2 |
| CK-MB        | 18.5 | 5.6  | 17.9   | 5.2  | 45.0 |

---

### 📋 Categorical Variables Summary

| Variable             | Positive_Count | Negative_Count | Positive_Ratio | Negative_Ratio |
|----------------------|----------------|----------------|----------------|----------------|
| Sex (Female)         | 522            | 8512           | 0.547          | 0.409          |
| Hypertension         | 645            | 12003          | 0.676          | 0.577          |
| DVT                  | 87             | 645            | 0.091          | 0.031          |
| Atrial fibrillation  | 164            | 2017           | 0.172          | 0.097          |
| Hyperuricemia        | 128            | 1583           | 0.134          | 0.076          |
| Hydrocephalus        | 104            | 512            | 0.109          | 0.025          |
| Fatty liver          | 89             | 4021           | 0.093          | 0.193          |

---



## 五、重要变量和数据(中文展示)

---

### 📊 连续变量汇总表

| 变量名称     | 平均值 | 标准差 | 中位数 | 最小值 | 最大值 |
|--------------|--------|--------|--------|--------|--------|
| NIHSS评分     | 7.2    | 3.1    | 7      | 0      | 24     |
| 白细胞（WBC） | 8.5    | 2.3    | 8.4    | 3.2    | 18.1   |
| D-二聚体      | 0.98   | 0.45   | 0.92   | 0.1    | 2.6    |
| 乳酸（Lactate） | 1.8    | 0.6    | 1.75   | 0.5    | 4.0    |
| 天门冬氨酸转氨酶（AST） | 25.4   | 10.7   | 24     | 10     | 75     |
| C反应蛋白（CRP） | 9.1    | 4.2    | 8.8    | 1.2    | 23.5   |
| 糖化血红蛋白（HbA1c） | 6.4    | 1.1    | 6.2    | 4.8    | 10.2   |
| 肌酸激酶同工酶（CK-MB） | 18.5   | 5.6    | 17.9   | 5.2    | 45.0   |

---

### 📋 分类变量汇总表

| 变量名称         | PSE阳性人数 | PSE阴性人数 | 阳性构成比 | 阴性构成比 |
|------------------|--------------|--------------|------------|------------|
| 女性              | 522          | 8512         | 0.547      | 0.409      |
| 高血压            | 645          | 12003        | 0.676      | 0.577      |
| 深静脉血栓（DVT） | 87           | 645          | 0.091      | 0.031      |
| 房颤              | 164          | 2017         | 0.172      | 0.097      |
| 高尿酸血症        | 128          | 1583         | 0.134      | 0.076      |
| 脑积水            | 104          | 512          | 0.109      | 0.025      |
| 脂肪肝            | 89           | 4021         | 0.093      | 0.193      |

---


## 六、模拟数据
请你根据上述抓取的数据信息，给出python代码，并给这份代码取个名字，用于模拟上述数据，最终保存为csv格式，保存的路径为04文献阅读\08神经内科\01急性缺血性脑卒中患者一年内继发性癫痫的预测模型\03模拟数据\01data


## 七、复现代码
请你根据上述生成的数据，按照这篇文献的思路和方法，给出python代码，并给这份代码取个名字，用于复现上述文献中的结果，下述内容是你刚刚给我的实施计划，供你参考：







# 原文(提供原始代码)
01急性缺血性脑卒中患者一年内继发性癫痫的预测模型
Predictive models for secondary epilepsy in patients with acute ischemic stroke within one year

## Abstract  摘要
### Background:  背景资料：
Post-stroke epilepsy (PSE) is a critical complication that worsens both prognosis and quality of life in patients with ischemic stroke. An interpretable machine learning model was developed to predict PSE using medical records from four hospitals in Chongqing.
卒中后癫痫（PSE）是影响缺血性卒中患者预后和生活质量的重要并发症。利用重庆市 4 家医院的病历资料，建立了一个可解释的机器学习模型来预测 PSE。

### Methods:  研究方法：
Medical records, imaging reports, and laboratory test results from 21,459 ischemic stroke patients were collected and analyzed. Univariable and multivariable statistical analyses identified key predictive factors. The dataset was split into a 70% training set and a 30% testing set. To address the class imbalance, the Synthetic Minority Oversampling Technique combined with Edited Nearest Neighbors was employed. Nine widely used machine learning algorithms were evaluated using relevant prediction metrics, with SHAP (SHapley Additive exPlanations) used to interpret the model and assess the contributions of different features.
收集并分析了 21,459 例缺血性卒中患者的病历、影像学报告和实验室检查结果。单变量和多变量统计分析确定了关键的预测因素。该数据集分为 70%的训练集和 30%的测试集。为了解决类别不平衡，采用了合成少数过采样技术结合编辑最近邻。使用相关的预测指标评估了九种广泛使用的机器学习算法，SHAP（SHapley Additive exPlanations）用于解释模型并评估不同特征的贡献。

### Results:  结果如下：
Regression analyses revealed that complications such as hydrocephalus, cerebral hernia, and deep vein thrombosis, as well as specific brain regions (frontal, parietal, and temporal lobes), significantly contributed to PSE. Factors such as age, gender, NIH Stroke Scale (NIHSS) scores, and laboratory results like WBC count and D-dimer levels were associated with increased PSE risk. Tree-based methods like Random Forest, XGBoost, and LightGBM showed strong predictive performance, achieving an AUC of 0.99.
回归分析显示，并发症，如脑积水，脑疝，深静脉血栓形成，以及特定的大脑区域（额叶，顶叶和颞叶），显着有助于 PSE。年龄、性别、NIH 卒中量表（NIHSS）评分和实验室检查结果（如 WBC 计数和 D-二聚体水平）等因素与 PSE 风险增加相关。基于树的方法，如 Random Forest、XGBoost 和 LightGBM 显示出强大的预测性能，AUC 为 0.99。

### Conclusions:  结论：
The model accurately predicts PSE risk, with tree-based models demonstrating superior performance. NIHSS score, WBC count, and D-dimer were identified as the most crucial predictors.
该模型准确预测 PSE 风险，基于树的模型表现出优越的上级性能。NIHSS 评分、WBC 计数和 D-二聚体被确定为最重要的预测因子。

### Funding:  资金来源：
The research is funded by Central University basic research young teachers and students research ability promotion sub-projec t(2023CDJYGRH-ZD06), and by Emergency Medicine Chongqing Key Laboratory Talent Innovation and development joint fund project (2024RCCX10).
本研究受中央大学基础研究青年师生科研能力提升子项目（2023 CDJYGRH-ZD 06）资助，受急诊医学重庆市重点实验室人才创新发展联合基金项目（2024 RCCX 10）资助。

### Research organism: None
研究微生物： 无

## Introduction  介绍
Stroke is the second leading cause of death worldwide, with an annual mortality of about 5.5 million, and is the leading cause of disability, accounting for 50% of cases globally (Feigin et al., 2017). Ischemic strokes make up approximately 80% of all stroke cases (Galovic et al., 2018; Krishnamurthi et al., 2013). PSE is a common complication, with studies showing that 3–30% of stroke patients develop epilepsy, which worsens their prognosis and quality of life (Zhao et al., 2018). PSE can exacerbate cognitive, psychiatric, and physical impairments caused by cerebrovascular disease and related conditions (Al-Sahli et al., 2023). The highest incidence of PSE occurs within the first year after an acute stroke, representing nearly half of all cases (Galovic et al., 2018). Therefore, early prediction and intervention for PSE, especially in ischemic strokes, are essential.
中风是全球第二大死亡原因，每年死亡人数约为 550 万，并且是残疾的主要原因，占全球病例的 50%（ Feigin et al., 2017 ）。缺血性中风约占所有中风病例的 80%（ Galovic et al., 2018 ; Krishnamurthi et al., 2013 ）。PSE 是一种常见的并发症，研究表明 3-30%的中风患者会发生癫痫，这会影响他们的预后和生活质量（ Zhao et al., 2018 ）。PSE 可加重脑血管疾病和相关疾病引起的认知、精神和身体损害（ Al-Sahli et al., 2023 ）。PSE 的最高发病率发生在急性卒中后的第一年内，占所有病例的近一半（ Galovic et al., 2018 ）。因此，早期预测和干预 PSE，尤其是缺血性卒中至关重要。

Currently, most studies rely on clinical data to build statistical models using survival analysis, Cox regression (Galovic et al., 2018; Chen et al., 2018), and multiple linear regression (Merkler et al., 2018) to predict PSE. Last year, Lin et al., 2023 developed a radiomics-based model that outperformed conventional clinical models in predicting PSE related to intracerebral hemorrhage (ICH), suggesting that a combined radiomics-clinical model could improve individual risk assessment of PSE after the first ICH, facilitating early diagnosis and treatment. However, later research raised concerns about the use of radiomics, indicating the need for further investigation (Pszczolkowski and Law, 2023). Overall, research on PSE prediction remains limited, with most studies focusing on specific risk factors (Waafi et al., 2023; Herzig-Nichtweiß et al., 2023; Lin et al., 2023; Pitkänen et al., 2016) and building basic models, rather than proposing more comprehensive and scientifically robust prediction models.
目前，大多数研究依赖于临床数据，使用生存分析、考克斯回归（ Galovic et al., 2018 ; Chen et al., 2018 ）和多元线性回归（ Merkler et al., 2018 ）建立统计模型来预测 PSE。去年， Lin et al., 2023 开发了一种基于放射学的模型，在预测脑出血（ICH）相关 PSE 方面优于传统临床模型，表明放射学-临床联合模型可以改善首次 ICH 后 PSE 的个体风险评估，促进早期诊断和治疗。然而，后来的研究对放射组学的使用提出了担忧，表明需要进一步研究（ Pszczolkowski and Law, 2023 ）。总体而言，关于 PSE 预测的研究仍然有限，大多数研究都集中在特定的风险因素（ Waafi et al., 2023 ; Herzig-Nichtweiß et al., 2023 ; Lin et al., 2023 ; Pitkänen et al., 2016 ）和建立基本模型，而不是提出更全面和科学可靠的预测模型。

Machine learning has gained recognition as a powerful tool for developing medical models, due to its ability to process large datasets and handle complex information. It has been increasingly applied in neuroscience and clinical prediction (El Naamani et al., 2024; Lu et al., 2023; Daidone et al., 2024). Previous studies have used machine learning to explore post-stroke cognitive impairments (Lee et al., 2023), predict stroke and myocardial infarction risk in patients with large artery vasculitis (Lu et al., 2023), develop post-stroke depression models using liver function tests (Gong et al., 2023), and predict hematoma expansion in traumatic brain injury (TBI) (He et al., 2024). Machine learning models can automatically capture both linear and complex nonlinear relationships between variables, providing insights into how different factors contribute to the prediction target—something traditional statistical models struggle with. However, machine learning requires large datasets and is prone to overfitting when sample sizes are small. The quality and quantity of input data are critical for the algorithm to detect patterns and make accurate predictions.
机器学习已被公认为开发医学模型的强大工具，因为它能够处理大型数据集和处理复杂信息。它已越来越多地应用于神经科学和临床预测（ El Naamani et al., 2024 ; Lu et al., 2023 ; Daidone et al., 2024 ）。以前的研究使用机器学习来探索中风后认知障碍（ Lee et al., 2023 ），预测大动脉血管炎患者的中风和心肌梗死风险（ Lu et al., 2023 ），使用肝功能测试开发中风后抑郁模型（ Gong et al., 2023 ），并预测创伤性脑损伤（TBI）中的血肿扩张（ He et al., 2024 ）。机器学习模型可以自动捕捉变量之间的线性和复杂的非线性关系，从而深入了解不同因素对预测目标的影响，而这正是传统统计模型难以解决的问题。然而，机器学习需要大型数据集，并且在样本量较小时容易过拟合。 输入数据的质量和数量对于算法检测模式和做出准确预测至关重要。

This study aims to identify key risk factors from features extracted from clinical records and test data of ischemic stroke patients. Using these features, a machine learning-based model will be developed to predict PSE. By leveraging early admission data, the goal is to automatically predict the likelihood of PSE occurrence, guiding clinical decision-making and patient care.
本研究旨在从缺血性卒中患者的临床记录和测试数据中提取的特征中识别关键的危险因素。使用这些功能，将开发基于机器学习的模型来预测 PSE。通过利用早期入院数据，目标是自动预测 PSE 发生的可能性，指导临床决策和患者护理。

## Results  结果
### Filling of missing data  缺失数据的填补
Missing values were imputed using a Random Forest (RF) model, addressing one feature at a time. The imputed features included: Plt, WBC, RBC, HbA1c, CRP, TG, LDL, HDL, AST, ALT, bilirubin, albumin, urea, creatinine, BUA, PT, APTT, TT, INR, D-dimer, fibrinogen, CK, CK-MB, LDH, HBDH, IMA, lactate, anion gap, TCO2, and NIHSS (Figure 1).
使用随机森林（RF）模型插补缺失值，每次处理一个特征。插补特征包括：Plt、WBC、RBC、HbA 1c、CRP、TG、LDL、HDL、AST、ALT、胆红素、白蛋白、尿素、肌酐、BUA、PT、APTT、TT、INR、D-二聚体、纤维蛋白原、CK、CK-MB、LDH、HBDH、IMA、乳酸、阴离子间隙、TCO 2 和 NIHSS（ Figure 1 ）。
















### Characteristics of study participants    研究参与者的特征
A total of 21,459 patients were included in the study. The training set comprised 15,021 patients, with a PSE incidence of 4.3%. The test set consisted of 6438 patients, also with a 4.3% incidence of PSE. An external validation cohort included 536 patients from three hospitals. Detailed statistical information on the clinical characteristics is presented in (Supplementary file 1).
共有 21，459 名患者被纳入研究。训练集包括 15，021 名患者，PSE 发生率为 4.3%。测试集包括 6438 例患者，PSE 的发生率也为 4.3%。外部验证队列包括来自三家医院的 536 例患者。临床特征的详细统计信息见（ Supplementary file 1 ）。

Analysis indicated that patients with a higher likelihood of developing PSE had complications such as uremia, a history of DVT, atrial fibrillation, hyperuricemia, cerebral hernia, and hydrocephalus. Affected brain regions included the frontal, parietal, occipital, and temporal lobes, along with the cortex, subcortex, basal ganglia, and hypothalamus. General characteristics influencing risk included age, gender, and NIHSS. Laboratory indicators associated with a higher risk of PSE included WBC, HbA1c, CRP, TG, AST, ALT, bilirubin, urea, uric acid, APTT, PT, D-dimer, CK, CK-MB, LDH, HBDH, IMA, lactate, and anion gap. Significant p-values were also observed for fatty liver, coronary heart disease, hyperlipidemia, and HDL, with low or negative values linked to higher risks of secondary complications. Details of statistical, univariate, and multivariate regression analyses are provided in Supplementary file 1, Supplementary file 2, Supplementary file 3.
分析表明，发生 PSE 可能性较高的患者有并发症，如尿毒症、DVT 病史、房颤、高尿酸血症、脑疝和脑积水。受影响的大脑区域包括额叶、顶叶、枕叶和颞叶，以及沿着皮质、皮质下、基底神经节和下丘脑。影响风险的一般特征包括年龄、性别和 NIHSS。与 PSE 风险较高相关的实验室指标包括 WBC、HbA 1c、CRP、TG、AST、ALT、胆红素、尿素、尿酸、APTT、PT、D-二聚体、CK、CK-MB、LDH、HBDH、IMA、乳酸和阴离子间隙。脂肪肝、冠心病、高脂血症和 HDL 也观察到显著的 p 值，低值或负值与继发性并发症的风险较高相关。统计、单变量和多变量回归分析的详细信息见 Supplementary file 1 、 Supplementary file 2 、 Supplementary file 3 。

### Performance of machine learning models    机器学习模型的性能
Performance indicators for the machine learning models are summarized in Supplementary file 4. The ROC curves, calibration curve, and decision curve analysis (DCA) are shown in Figure 2. Tree-based models such as RF, XGBoost, and LightGBM demonstrated the highest AUC scores, outperforming other models. Among them, RF achieved the highest positive predictive value (PPV) at 0.864, which was the most significant metric in this study. Complex machine learning algorithms outperformed traditional logistic regression. The calibration curve showed a Brier score of 0.006, and DCA indicated strong practical value in clinical decision-making. In the external validation cohort, RF achieved a sensitivity of 0.91 and a PPV of 0.95, confirming its strong predictive capability.
机器学习模型的性能指标总结在 Supplementary file 4 中。ROC 曲线、校准曲线和决策曲线分析（DCA）见 Figure 2 。基于树的模型，如 RF，XGBoost 和 LightGBM 表现出最高的 AUC 分数，优于其他模型。其中，RF 达到了最高的阳性预测值（PPV），为 0.864，这是本研究中最重要的指标。复杂的机器学习算法优于传统的逻辑回归。校准曲线显示 Brier 评分为 0.006，DCA 在临床决策中具有很强的实用价值。在外部验证队列中，RF 实现了 0.91 的灵敏度和 0.95 的 PPV，证实了其强大的预测能力。












### Analysis of SHAP risk factors    SHAP 危险因素分析
Figure 3 presents SHAP values, individual decision attempts, and overall decision curves. Among general characteristics, females had a higher PSE rate. A higher NIHSS was associated with an increased incidence of PSE. Elevated WBC, D-dimer, CRP, AST, CK-MB, HbA1c, bilirubin, TCO2, and LDH levels at admission were linked to a greater likelihood of developing PSE. Conversely, lower levels of HBDH, Plt, and APTT were also associated with a higher risk of PSE. Specific brain regions did not have a significant individual effect on the outcome. Among complications, hypertension was more strongly associated with PSE development, while conditions such as coronary heart disease, diabetes, hyperlipidemia, and fatty liver were less likely to be related. A force plot for the first patient illustrated the influence of different features on the prediction. In this case, a prolonged APTT time contributed the most to PSE, followed by elevated AST levels, while a low NIHSS negatively impacted the final result. The decision plot aggregated model decisions to demonstrate how complex models generated their predictions.
Figure 3 显示 SHAP 值、单个决策尝试和总体决策曲线。在一般特征中，女性 PSE 率较高。较高的 NIHSS 与 PSE 的发生率增加相关。入院时 WBC、D-二聚体、CRP、AST、CK-MB、HbA 1c、胆红素、TCO 2 和 LDH 水平升高与发生 PSE 的可能性增加相关。相反，HBDH、Plt 和 APTT 水平较低也与 PSE 风险较高相关。特定的大脑区域对结果没有显著的个体影响。在并发症中，高血压与 PSE 的发生有更强的相关性，而冠心病、糖尿病、高脂血症和脂肪肝等疾病则不太可能相关。第一位患者的力图说明了不同特征对预测的影响。 在这种情况下，APTT 时间延长对 PSE 的贡献最大，其次是 AST 水平升高，而 NIHSS 较低对最终结果产生负面影响。决策图汇总了模型决策，以展示复杂模型如何生成其预测。












## Discussion  讨论
The study utilized comprehensive clinical, imaging, and laboratory data from stroke patients to develop a predictive model using machine learning algorithms. The model achieved an AUC above 0.95, indicating more accurate predictions compared to traditional statistical methods. Tree-based ensemble models demonstrated superior predictive performance, particularly when handling large datasets with high-dimensional features.
该研究利用中风患者的综合临床，成像和实验室数据，使用机器学习算法开发预测模型。该模型的 AUC 高于 0.95，表明与传统统计方法相比预测更准确。基于树的集成模型表现出上级预测性能，特别是在处理具有高维特征的大型数据集时。

During the modeling process, the extreme imbalance between negative and positive samples was addressed using the SMOTEENN technique, which improved model performance. SHAP analysis was conducted to assess model interpretability and identify the importance of different features.
在建模过程中，使用 SMOTEENN 技术解决了正负样本之间的极端不平衡，从而提高了模型性能。进行 SHAP 分析以评估模型的可解释性并确定不同特征的重要性。

According to the statistical results, age and NIHSS were treated as continuous variables. The results show that female patients, older individuals, and those with higher NIHSS were more likely to develop PSE, consistent with recent studies. Higher NIHSS, indicating more severe strokes, significantly increased the risk of complications, ranking second only to WBC and D-dimer in predictive importance (Al-Sahli et al., 2023; Lin et al., 2021; Waafi et al., 2023; Zöllner et al., 2020). However, there are differing perspectives regarding the effect of age. Some studies (Al-Sahli et al., 2023; Yamada et al., 2020) suggest that age below 65 is a high-risk factor, which aligns with this findings, while other studies (Lidetu and Zewdu, 2023) indicate that advanced age is the key factor. Yamada et al., 2020 supported the results, showing that female patients have a higher risk of complications, while (Waafi et al., 2023) reported that male patients are 3.325 times more likely to develop complications, contradicting these results.
根据统计结果，年龄和 NIHSS 被视为连续变量。结果表明，女性患者、老年人和 NIHSS 较高的患者更有可能发生 PSE，这与最近的研究一致。NIHSS 评分越高，表明卒中越严重，并发症风险显著增加，在预测重要性方面仅次于 WBC 和 D-二聚体（ Al-Sahli et al., 2023 ; Lin et al., 2021 ; Waafi et al., 2023 ; Zöllner et al., 2020 ）。然而，对于年龄的影响有不同的看法。一些研究（ Al-Sahli et al., 2023 ; Yamada et al., 2020 ）表明，65 岁以下是一个高风险因素，这与这一发现一致，而其他研究（ Lidetu and Zewdu, 2023 ）表明，高龄是关键因素。 Yamada et al., 2020 支持该结果，表明女性患者有更高的并发症风险，而（ Waafi et al., 2023 ）报告称男性患者发生并发症的可能性是男性患者的 3.325 倍，与这些结果相矛盾。

Previous research indicates that patients with diabetes, dyslipidemia, hypertension, depression, or dementia are at higher risk of developing vascular epilepsy (Pitkänen et al., 2016). In this study, statistical analysis and multiple ML models examined the relationship between comorbidities and complications. Patients with coronary heart disease, diabetes, fatty liver, hyperlipidemia, or large artery stenosis or plaques (CCA and ICA) were found to be less likely to develop epilepsy. According to the TOAST classification, ischemic stroke is divided into five categories: large artery atherosclerosis, cardioembolism, small vessel occlusion, other determined etiology, and undetermined etiology. Patients with multiple comorbidities often fall into the large artery atherosclerosis and cardioembolism categories, which are more clearly defined and easier to treat, resulting in a lower likelihood of epilepsy. In contrast, strokes of undetermined etiology tend to have worse prognoses and a higher likelihood of leading to epilepsy. Among patients with diabetes, higher HbA1c levels indicate poor blood sugar control and a higher risk of complications. Better blood sugar control was associated with a lower overall risk of developing complications.
先前的研究表明，糖尿病、血脂异常、高血压、抑郁症或痴呆症患者发生血管性癫痫的风险较高（ Pitkänen et al., 2016 ）。在这项研究中，统计分析和多个 ML 模型检查了合并症和并发症之间的关系。患有冠心病、糖尿病、脂肪肝、高脂血症或大动脉狭窄或斑块（CCA 和伊卡）的患者发生癫痫的可能性较低。根据吐司分类，缺血性卒中分为五类：大动脉粥样硬化、心源性栓塞、小血管闭塞、其他确定的病因和未确定的病因。患有多种合并症的患者通常属于大动脉粥样硬化和心源性栓塞类别，这些类别定义更明确，更容易治疗，导致癫痫的可能性较低。 相比之下，病因不明的中风往往有更严重的中风和更高的可能性导致癫痫。在糖尿病患者中，较高的 HbA1c 水平表明血糖控制不良和并发症风险较高。更好的血糖控制与更低的并发症发生风险相关。

Lekoubou et al., 2023 reported that cortical infarction is more likely to lead to epilepsy in patients hospitalized with anterior circulation ischemic stroke. Lin et al., 2023 also found that factors such as cortical involvement and intracerebral hemorrhage volume increase the likelihood of PSE, aligning with the statistical result findings. Al-Sahli et al. suggested that cortical brain injury and large-area lesions elevate the risk of PSE (Al-Sahli et al., 2023; Yamada et al., 2020). According to the statistical results, both cortical and subcortical involvement were associated with an increased likelihood of PSE, but these regions had a smaller influence compared to other features and were not selected in LASSO regression.
Lekoubou et al., 2023 报告称，在因前循环缺血性卒中住院的患者中，皮质梗死更可能导致癫痫。 Lin et al., 2023 还发现，皮质受累和脑内出血量等因素增加了 PSE 的可能性，与统计结果发现一致。Al-Sahli 等人认为皮质脑损伤和大面积病变会增加 PSE 的风险（ Al-Sahli et al., 2023 ; Yamada et al., 2020 ）。根据统计结果，皮质和皮质下受累均与 PSE 的可能性增加相关，但与其他特征相比，这些区域的影响较小，并且未在 LASSO 回归中选择。

Previous studies have identified acute infection as a risk factor for ischemic stroke (Bova et al., 1996). CRP, which reflects inflammation levels, is an independent prognostic factor (Di Napoli et al., 2001). Both regression and SHAP analysis of the results indicated that WBC had a significant impact among routine blood test parameters, even surpassing NIHSS in SHAP analysis. A high WBC may indicate severe inflammation or infection, as well as increased blood viscosity, predisposing patients to secondary complications. High RBC and low Plt counts were also associated with an increased risk of complications.
先前的研究已经确定急性感染是缺血性卒中的风险因素（ Bova et al., 1996 ）。反映炎症水平的 CRP 是一个独立的预后因素（ Di Napoli et al., 2001 ）。回归分析和 SHAP 分析结果均表明，WBC 在血常规指标中有显著影响，在 SHAP 分析中甚至超过 NIHSS。高 WBC 可能表明严重的炎症或感染，以及血液粘度增加，使患者易于继发并发症。高 RBC 和低 Plt 计数也与并发症风险增加相关。

A large-scale study on Chinese individuals found a negative correlation between plasma HDL and the risk of ischemic stroke, a weak positive correlation between TG levels and stroke risk, and a strong correlation between LDL and apolipoprotein B levels (Sun et al., 2019). High HDL levels are linked to better prognosis (Bandeali and Farmer, 2012). The data analysis and model interpretation results align with these findings, showing that high LDL, low HDL, and elevated TG levels are more likely to result in PSE. This can be explained by high cholesterol and TG levels increasing blood viscosity and contributing to vascular sclerosis, promoting clot formation (Pitkänen et al., 2016; Gasparini et al., 2022; Abraira et al., 2020). Higher D-dimer levels indicate more significant brain tissue damage, increasing the likelihood of PSE. In general, lower APTT and fibrinogen levels are associated with higher PSE risk, while INR, PT, and TT have smaller impacts. Among liver function indicators, AST had the greatest influence on PSE. High AST, low ALT, and low albumin levels also had some impact. Ding et al., 2023 reported that liver enzyme subgroups defined by ALT and AST were linked to higher risks of adverse outcomes, consistent with this findings.
一项针对中国个体的大规模研究发现，血浆 HDL 与缺血性卒中风险呈负相关，TG 水平与卒中风险呈弱正相关，LDL 与载脂蛋白 B 水平呈强相关（ Sun et al., 2019 ）。高 HDL 水平与更好的预后有关（ Bandeali and Farmer, 2012 ）。数据分析和模型解释结果与这些发现一致，表明高 LDL，低 HDL 和 TG 水平升高更可能导致 PSE。这可以解释为高胆固醇和 TG 水平增加血液粘度，并有助于血管硬化，促进凝块形成（ Pitkänen et al., 2016 ; Gasparini et al., 2022 ; Abraira et al., 2020 ）。较高的 D-二聚体水平表明更严重的脑组织损伤，增加了 PSE 的可能性。一般而言，较低的 APTT 和纤维蛋白原水平与较高的 PSE 风险相关，而 INR、PT 和 TT 的影响较小。肝功能指标中，AST 对 PSE 的影响最大。 高 AST、低 ALT 和低白蛋白水平也有一定影响。 Ding et al., 2023 报告称，由 ALT 和 AST 定义的肝酶亚组与不良结局的较高风险相关，与该结果一致。

Studies have shown that renal function biomarkers such as urinary microalbumin, cystatin C, and creatinine are associated with higher stroke recurrence rates and poorer prognosis (Ding et al., 2023). In the light of statistical results, low urea levels and high uric acid levels had a negative impact (Zhang et al., 2023; Wang et al., 2019; Wang et al., 2021). Elevated uric acid at admission was positively associated with PSE, although patients with a prior diagnosis of hyperuricemia were less likely to develop epilepsy. Since uric acid acts as a strong antioxidant and has neuroprotective properties (Ng et al., 2017), patients with normal liver and kidney function and mild hyperuricemia may exhibit greater resilience in emergencies (Amaro et al., 2011). However, excessively high uric acid levels suggest metabolic disorders and poor liver and kidney function, which are linked to a poor prognosis.
研究表明，肾功能生物标志物如尿微量白蛋白、胱抑素 C 和肌酐与较高的卒中复发率和较差的预后相关（ Ding et al., 2023 ）。根据统计结果，低尿素水平和高尿酸水平具有负面影响（ Zhang et al., 2023 ; Wang et al., 2019 ; Wang et al., 2021 ）。入院时尿酸升高与 PSE 呈正相关，尽管先前诊断为高尿酸血症的患者不太可能发展为癫痫。由于尿酸作为一种强抗氧化剂，具有神经保护作用（ Ng et al., 2017 ），肝肾功能正常和轻度高尿酸血症的患者在紧急情况下可能表现出更大的弹性（ Amaro et al., 2011 ）。然而，过高的尿酸水平提示代谢紊乱和肝肾功能不良，这与预后不良有关。

When stroke patients are admitted, cardiac enzyme tests are often performed to rule out myocardial ischemia. However, studies have shown that elevated CK-MB in stroke patients may not be solely heart-related (Ay et al., 2002). Cardiac enzymes are important prognostic indicators (Liu et al., 2014; Zeng et al., 2021) and have been incorporated into stroke scores (Hijazi et al., 2016). Some studies have reported a higher incidence of abnormal serum cardiac enzyme levels in the acute phase of stroke. Although these abnormalities are not related to stroke type, they are associated with stroke severity, with patients exhibiting consciousness disorders having a significantly higher incidence of abnormal cardiac enzymes than those without such disorders (Zheng Yuan-Hui and Jian, 2009). According to the statistical and SHAP results, CK, CK-MB, and IMA in the cardiac enzyme profile demonstrated significant impact and high predictive value, though further research is needed to understand the specific mechanisms involved (Ng et al., 2017).
当中风患者入院时，经常进行心肌酶试验以排除心肌缺血。然而，研究表明，中风患者的 CK-MB 升高可能不仅仅与心脏相关（ Ay et al., 2002 ）。心肌酶是重要的预后指标（ Liu et al., 2014 ; Zeng et al., 2021 ），已纳入卒中评分（ Hijazi et al., 2016 ）。一些研究报道了中风急性期血清心肌酶水平异常的发生率较高。尽管这些异常与卒中类型无关，但与卒中严重程度相关，表现出意识障碍的患者与无意识障碍的患者相比，心肌酶异常的发生率显著更高（ Zheng Yuan-Hui and Jian, 2009 ）。根据统计和 SHAP 结果，心肌酶谱中的 CK、CK-MB 和 IMA 表现出显著影响和高预测价值，但需要进一步研究以了解所涉及的具体机制（ Ng et al., 2017 ）。

Despite incorporating extensive clinical, imaging, and laboratory data to build more accurate prediction models using machine learning algorithms, surpassing traditional statistical methods, there were several limitations in the modeling process.
尽管使用机器学习算法结合了大量的临床、成像和实验室数据来构建更准确的预测模型，超越了传统的统计方法，但建模过程中仍存在一些局限性。

Although the current study offers valuable insights, the dataset may not be fully representative, and the model’s generalizability requires further evaluation. The data were collected from multiple tertiary hospitals and included over 20,000 cases, but earlier data were lost due to hospital system upgrades. Consequently, the dataset primarily reflects patients diagnosed within the past five years and is predominantly from the Chongqing region, which may limit the model’s applicability to other geographic areas.
尽管目前的研究提供了有价值的见解，但数据集可能不具有充分的代表性，模型的普遍性需要进一步评估。这些数据是从多家三级医院收集的，包括20，000多例病例，但由于医院系统升级，早期数据丢失。因此，该数据集主要反映了过去五年内诊断的患者，并且主要来自重庆地区，这可能限制了该模型对其他地理区域的适用性。

Additionally, the retrospective nature of the study led to the absence of some important predictive indicators. Several potentially valuable features, such as hemorheology, thromboelastography, and hormone levels, were missing and had to be excluded, potentially affecting the model’s accuracy. Including these features could further enhance the model’s predictive power.
此外，该研究的回顾性性质导致缺乏一些重要的预测指标。几个潜在的有价值的特征，如血液流变学，血栓弹性描记术和激素水平，缺失，不得不被排除，可能影响模型的准确性。包括这些特征可以进一步增强模型的预测能力。

To improve the model, it would be beneficial to incorporate additional data beyond baseline patient characteristics. The current analysis mainly used results from the initial examination upon admission, without fully leveraging information from subsequent exams. Future research could employ recurrent neural networks to extract features from the entire sequence of examinations more comprehensively.
为了改进模型，将基线患者特征之外的其他数据纳入将是有益的。目前的分析主要使用入学时的初步检查结果，而没有充分利用后续检查的信息。未来的研究可以使用递归神经网络更全面地从整个检查序列中提取特征。

To strengthen this study further, data standardization should be improved, and the number of cases and key indicators should continue to grow. Additionally, exploring more advanced scientific methods, such as deep learning, and utilizing all available data could enhance prediction accuracy.
为进一步加强这一研究，应提高数据标准化，并应继续增加案例和关键指标的数量。此外，探索更先进的科学方法，如深度学习，并利用所有可用的数据可以提高预测的准确性。


## Materials and methods  材料和方法
### Research patients  研究患者
This study retrospectively included all stroke patients admitted to Chongqing Emergency Center between June 2017 and June 2022 to develop the prediction model. Data from three external validation centers—Qianjiang Central Hospital, Bishan District People’s Hospital, and Yubei District Traditional Chinese Medicine Hospital—were collected between July 2022 and July 2023 to validate and evaluate the model externally. The external validation cohort focused on collecting positive cases to accurately test the model’s ability to identify them.
本研究回顾性纳入了2017年6月至2022年6月重庆市急救中心收治的所有脑卒中患者，以建立预测模型。在2022年7月至2023年7月期间，收集了三家外部验证中心--黔江区中心医院、璧山区人民医院、渝北区中医院的数据，对模型进行外部验证和评估。外部验证队列专注于收集阳性案例，以准确测试模型识别它们的能力。

Inclusion criteria included: (1) Patients aged 18–90 years at admission; (2) Diagnosed with acute ischemic stroke and hospitalized for treatment.
入选标准包括：（1）患者入院时年龄18-90岁;（2）诊断为急性缺血性卒中并住院治疗。

Exclusion criteria were: (1) History of stroke or transient ischemic attack (TIA); (2) History of conditions such as traumatic brain injury, intracranial tumors, or cerebral vascular malformations that may cause epilepsy; (3) History of epilepsy or prior antiseizure medication use for seizure prevention or for other diseases (e.g. migraine or psychiatric disorders); (4) Death within 72 hr after stroke onset.
排除标准为：（1）卒中或短暂性脑缺血发作（TIA）史;（2）可能导致癫痫的创伤性脑损伤、颅内肿瘤或脑血管畸形等疾病史;（3）癫痫史或既往使用抗癫痫药物预防癫痫发作或治疗其他疾病（如偏头痛或精神疾病）;（4）卒中发作后 72 小时内死亡。

De-identified data from relevant patients were collected to build a multi-modal stroke patient database. The study protocol was approved by the Ethics Committees of Chongqing University Center Hospital, Chongqing University Qianjiang Central Hospital, Bishan District People’s Hospital, and Yubei District Traditional Chinese Medicine Hospital.
收集相关患者的去识别数据，以建立多模式卒中患者数据库。本研究方案获得了重庆大学中心医院、重庆大学黔江中心医院、璧山区人民医院、渝北区中医院伦理委员会的批准。

The selection process is outlined in Figure 4. A total of 42,079 records were retrieved from the stroke database, and 24,733 patients were diagnosed with new-onset ischemic or lacunar stroke. Patients with hemorrhagic strokes (4565), a history of stroke (2154), TIA (3570), unclear-cause strokes (561), and those with missing essential data (6496) were excluded. Additionally, patients whose seizures may have been caused by other factors (such as brain tumors, intracranial vascular malformations, or traumatic brain injury) (865), those with a history of seizures (152), and those who died in the hospital (1444) were excluded. Patients lost to follow-up (those without outpatient records or unreachable by phone) or who died within three months of the stroke incident (813) were also excluded. In total, 21,459 cases were included in the study.
选择过程在 Figure 4 中概述。从卒中数据库中共检索到 42，079 条记录，24，733 例患者被诊断为新发缺血性或腔隙性卒中。排除了出血性卒中（4565 例）、卒中史（2154 例）、TIA（3570 例）、原因不明卒中（561 例）和基本数据缺失（6496 例）的患者。此外，排除了癫痫发作可能由其他因素（如脑肿瘤、颅内血管畸形或创伤性脑损伤）引起的患者（865）、有癫痫发作史的患者（152）和在医院死亡的患者（1444）。失访患者（没有门诊记录或无法通过电话联系的患者）或在卒中事件发生后 3 个月内死亡的患者（813）也被排除在外。共有 21，459 例病例纳入研究。















### Data collection  数据收集
Relevant records and data were extracted from hospital databases. PostgreSQL was used to manage the data, with Structured Query Language (SQL) queries organized as follows:
从医院数据库中提取相关记录和数据。PostgreSQL 用于管理数据，结构化查询语言（SQL）查询组织如下：

General Information: This included gender, age, and NIH Stroke Scale (NIHSS) score at admission.
一般信息：包括性别、年龄和入院时的 NIH 卒中量表（NIHSS）评分。

Comorbidities and Complications: Conditions such as uremia, deep vein thrombosis (DVT), diabetes mellitus, hypertension, coronary atherosclerosis, atrial fibrillation, cerebral hernia, hydrocephalus, hypoproteinemia, hyperuricemia, hyperlipidemia, internal carotid stenosis, and common carotid stenosis were recorded.
合并症和并发症：记录尿毒症、深静脉血栓形成（DVT）、糖尿病、高血压、冠状动脉粥样硬化、房颤、脑疝、脑积水、低蛋白血症、高尿酸血症、高脂血症、颈内动脉狭窄和颈总动脉狭窄等疾病。

Brain Involvement (CT or MRI records): Involvement of cortical lobes (frontal, parietal, temporal, occipital, and insular) and subcortical areas (basal ganglia, internal capsule, brain stem, cerebellum, periventricular area, centrum semiovale, and thalamus) was noted. Cortical involvement was scored with each lobe contributing 1 point, and subcortical involvement was scored similarly, with each area contributing 1 point.
脑部受累（CT 或 MRI 记录）：注意到皮质叶（额叶、顶叶、颞叶、枕叶和岛叶）和皮质下区域（基底节、内囊、脑干、小脑、室周区、半卵圆中心和丘脑）受累。皮质受累评分，每个叶贡献 1 分，皮质下受累评分相似，每个区域贡献 1 分。

Vascular Involvement (CTA, MRA, or DSA records): The presence of vascular stenosis or occlusion in the anterior cerebral artery (ACA), middle cerebral artery (MCA), posterior cerebral artery (PCA), vertebral artery (VA), and basilar artery (BA) was documented.
血管受累（CTA、MRA 或 DSA 记录）：记录大脑前动脉（ACA）、大脑中动脉（MCA）、大脑后动脉（PCA）、椎动脉（VA）和基底动脉（BA）中存在血管狭窄或闭塞。

Key Laboratory Indicators: These included blood lipid levels such as triglycerides, high-density lipoprotein cholesterol (HDL), and low-density lipoprotein cholesterol (LDL); liver function markers such as alanine transaminase (ALT), aspartate aminotransferase (AST), bilirubin, and albumin; renal function markers such as urea, blood uric acid (BUA), and creatinine; blood gas parameters such as lactate, anion gap, and total carbon dioxide (TCO2); coagulation markers such as international normalized ratio (INR), prothrombin time (PT), activated partial thromboplastin time (APTT), thrombin time (TT), D-dimer, and fibrinogen; and myocardial enzymes such as creatine kinase (CK), creatine kinase isoenzyme (CK-MB), lactate dehydrogenase (LDH), ischemic modified albumin (IMA), and α-hydroxybutyrate dehydrogenase (HBDH).
关键实验室指标：这些指标包括血脂水平，如甘油三酯、高密度脂蛋白胆固醇（HDL）和低密度脂蛋白胆固醇（LDL）;肝功能指标，如丙氨酸转氨酶（ALT）、天冬氨酸转氨酶（AST）、胆红素和白蛋白;肾功能指标，如尿素、血尿酸（BUA）和肌酐;血气参数，如乳酸、阴离子间隙和总二氧化碳（TCO 2）;凝血标志物如国际标准化比率（INR）、凝血酶原时间（PT）、活化部分凝血活酶时间（APTT）、凝血酶时间（TT）、D-二聚体和纤维蛋白原;和心肌酶如肌酸激酶（CK）、肌酸激酶同工酶（CK-MB）、乳酸脱氢酶（LDH）、缺血修饰白蛋白（IMA）和α-羟基丁酸脱氢酶（HBDH）。





### Data processing and model building    数据处理和模型建立
Processing of Missing Data: Laboratory indicators were recorded from the first set of tests after stroke admission. Indicators with more than 10% missing data were excluded. Remaining indicators with missing values were imputed using the random forest algorithm with default parameters. Features were processed in order of increasing missing data to minimize imputation complexity. During imputation, missing values in other features were temporarily replaced with 0, and predicted values were inserted into the original feature matrix before moving to the next feature. This process continued until all features were complete.
缺失数据的处理：记录中风入院后第一组检查的实验室指标。缺失数据超过10%的指标被排除在外。其余缺失值的指标采用随机森林算法和默认参数进行估算。按照增加缺失数据的顺序处理特征，以最大限度地减少插补复杂性。在插补过程中，其他特征中的缺失值暂时用0替换，预测值在移动到下一个特征之前插入到原始特征矩阵中。这个过程一直持续到所有功能完成。

Distribution of Characteristics: Univariate analysis was performed to compare the distribution of characteristics between PSE-negative and PSE-positive groups. The dataset was then divided into a training set and a test set in a 7:3 ratio.
特征分布：进行单因素分析，比较 PSE 阴性和 PSE 阳性组之间的特征分布。然后将数据集以 7：3 的比例分为训练集和测试集。

Handling Imbalanced Data: Due to the low incidence of PSE and the small proportion of positive cases, positive data in the training set were augmented using the Synthetic Minority Over-sampling Technique combined with Edited Nearest Neighbors (SMOTEENN). The SMOTEENN method from the imblearn Python package was applied with default parameters, and a random seed of 42 was set for reproducibility.
处理不平衡数据：由于 PSE 的发病率低，阳性病例的比例小，训练集中的阳性数据使用合成少数过采样技术结合编辑最近邻（SMOTEENN）进行了扩增。使用默认参数应用 imblearn Python 包中的 SMOTEENN 方法，并将随机种子设置为 42 以确保重现性。

Processing of Categorical Data: Categorical variables were transformed using one-hot encoding. The LASSO method was then applied to the training set to identify the most important features.
分类数据的处理：使用独热编码转换分类变量。然后将 LASSO 方法应用于训练集以识别最重要的特征。

Model Building: LASSO regression was used to select the 20 most important features. Nine widely used machine learning methods were employed, including Naive Bayes, Logistic Regression, Decision Tree, Random Forest, Gradient Boosting, Multi-Layer Perceptron, XGBoost, LightGBM, and K-Nearest Neighbors. Hyperparameters were optimized through grid search to enhance model performance. Evaluation metrics included accuracy, sensitivity, specificity, F1-score, positive predictive value, and negative predictive value. Additionally, ROC curves, calibration curves, and decision curves were generated to assess model performance. An independent external validation dataset was used to evaluate the model’s generalizability. The SHAP algorithm was then applied to the best-performing model to interpret feature contributions and their clinical relevance. This approach enabled the development of a robust machine learning model with strong predictive performance and interpretability, providing valuable support for clinical decision-making.
模型构建：使用 LASSO 回归来选择 20 个最重要的特征。使用了九种广泛使用的机器学习方法，包括朴素贝叶斯，逻辑回归，决策树，随机森林，梯度提升，多层感知器，XGBoost，LightGBM 和 K 最近邻。通过网格搜索优化超参数，以提高模型性能。评价指标包括准确性、灵敏度、特异性、F1 评分、阳性预测值和阴性预测值。此外，生成 ROC 曲线、校准曲线和决策曲线以评估模型性能。一个独立的外部验证数据集被用来评估模型的泛化能力。然后将 SHAP 算法应用于性能最佳的模型，以解释特征贡献及其临床相关性。 这种方法能够开发出具有强大预测性能和可解释性的强大机器学习模型，为临床决策提供有价值的支持。






### Statistical approach  统计方法
PostgreSQL v15 (http://www.postgresql.org/) was used to search and extract data from the local database. Statistical analysis was performed using the open-source Scipy.stats package in Python. The details of the univariate significance analysis were as follows:
使用 PostgreSQL v15（ http://www.postgresql.org/ ）从本地数据库中搜索和提取数据。使用 Python 中的开源 Scipy.stats 包进行统计分析。单变量显著性分析的详情如下：

The Shapiro-Wilk test was used to assess the normality of each feature’s distribution. For features not following a normal distribution, the Mann-Whitney U test was used to evaluate their significance in relation to the target variable. For features with a normal distribution, the Levene test was performed to evaluate the homogeneity of variances. Features with homogeneous variances were analyzed using the Student’s t-test, while those with heterogeneous variances were analyzed using Welch’s t-test.
Shapiro-Wilk 检验用于评估每个特征分布的正态性。对于不遵循正态分布的特征，使用 Mann-Whitney U 检验评价其相对于目标变量的显著性。对于具有正态分布的特征，进行 Levene 检验以评价方差齐性。使用 Student t 检验分析具有齐性方差的特征，而使用 Welch t 检验分析具有异性方差的特征。

Confidence intervals for AUC values and Brier scores were calculated using 1000 bootstrap resampling iterations. Binary classification thresholds for predicted probabilities were set using the maximum Youden index derived from the training cohort. A two-tailed p-value of less than 0.05 was considered statistically significant throughout the study.
AUC 值和 Brier 评分的置信区间使用 1000 次 bootstrap 重新验证迭代计算。预测概率的二元分类阈值使用从训练群组导出的最大 Youden 指数来设定。在整个研究期间，认为双尾 p 值小于 0.05 具有统计学显著性。

All code used in this study is available at https://github.com/conanan/lasso-ml (copy archived at conanan, 2024).
本研究中使用的所有代码可在 https://github.com/conanan/lasso-ml 中获得（副本存档于 conanan, 2024 ）。


## Conclusion  结论
An interpretable machine learning model was developed to predict the risk of PSE in hospitalized patients with ischemic stroke. Using a large dataset of medical records, the model demonstrated strong predictive performance for PSE. Key predictors identified by the model include NIHSS, D-dimer, lactate, and WBC, along with liver function and cardiac enzyme profile indicators. The model’s transparency and interpretability can build trust among clinicians and support decision-making. While the results are promising, further prospective studies are necessary to validate the clinical utility of this tool before it can be applied in real-world settings.
开发了一种可解释的机器学习模型来预测缺血性卒中住院患者的 PSE 风险。使用大型医疗记录数据集，该模型对 PSE 表现出强大的预测性能。该模型确定的关键预测因子包括 NIHSS、D-二聚体、乳酸和 WBC，沿着肝功能和心肌酶谱指标。该模型的透明度和可解释性可以在临床医生之间建立信任并支持决策。虽然结果是有希望的，但在将其应用于现实世界之前，还需要进一步的前瞻性研究来验证该工具的临床实用性。


## Acknowledgements  确认
The authors would like to thank their colleagues in the information and imaging departments for their hard work contributing to the final research results.
作者要感谢他们在信息和成像部门的同事，感谢他们为最终研究结果所做的辛勤工作。

## Funding Statement  资金报表
The funders had no role in study design, data collection and interpretation, or the decision to submit the work for publication.
资助者不参与研究设计、数据收集和解释，也不参与决定是否将研究成果提交出版。


## Contributor Information  贡献者信息
Shanshan Tian, Email: 710836163@qq.com.
田珊珊，邮箱：710836163@qq.com。

Yongbing Deng, Email: dyb0913@cqu.edu.cn.
邓永兵，电子邮箱：dyb0913@cqu.edu.cn。

Alan Talevi, National University of La Plata, Argentina.
阿兰·塔莱维，阿根廷拉普拉塔国立大学。

Eduardo L Franco, McGill University, Canada.
Eduardo L Franco，加拿大麦吉尔大学。


## Funding Information  资助信息
This paper was supported by the following grants:
本论文得到了以下赠款：

Central University Basic Research Fund of China 2023CDJYGRH-ZD06 to Yongbing Deng.
中央大学基础研究基金 2023 CDJYGRH-ZD 06 给邓永兵。

Emergency Medicine chongqing Key Laboratory Talent Innovation and development joint fund project 2024RCCX10 to Yongbing Deng.
急诊医学重庆市重点实验室人才创新发展联合基金项目 2024RCCX10 给邓永兵。











