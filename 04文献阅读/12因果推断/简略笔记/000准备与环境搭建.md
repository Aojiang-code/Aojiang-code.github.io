# 📓 阶段 0 学习笔记 —— 医学因果推断实践准备

## 0.1 环境搭建与包安装

在因果推断实践中，我们会用到三类 Python 库：

1. **数据处理与可视化**

   * `pandas`：数据表格处理
   * `numpy`：数值计算
   * `matplotlib` & `seaborn`：数据可视化

2. **统计与机器学习**

   * `scikit-learn`：机器学习模型与数据预处理
   * `statsmodels`：统计建模（如逻辑回归、Cox 回归）

3. **因果推断专用工具**

   * `dowhy`：微软开源的因果推断框架，支持因果图、ATE估计、敏感性分析
   * `econml`：微软开源，支持个体化治疗效果估计（CATE/ITE）
   * `causalml`：Uber 开源，适合做倾向评分匹配、因果森林等

**安装命令：**

```bash
pip install pandas numpy matplotlib seaborn scikit-learn statsmodels dowhy econml causalml
```

> 💡 建议在虚拟环境（conda 或 venv）中安装，以免和其他项目冲突
>
> ```bash
> conda create -n causal python=3.10
> conda activate causal
> pip install ...
> ```

---

## 0.2 Python 必备工具回顾（快速复习）

回顾python 基础，这里提供一些 Python 基础知识，你可以快速复习。

### 0.2.1 `pandas` 数据操作

```python
import pandas as pd

# 读取 CSV 文件
df = pd.read_csv("data.csv")

# 查看前几行
print(df.head())

# 查看数据类型和缺失值
print(df.info())

# 筛选：选择糖尿病患者
df_diabetes = df[df['diabetes'] == 1]

# 统计：每种性别的平均年龄
print(df.groupby('sex')['age'].mean())
```

---

### 0.2.2 可视化

```python
import matplotlib.pyplot as plt
import seaborn as sns

# 直方图：年龄分布
sns.histplot(df['age'], kde=True)
plt.show()

# 箱线图：不同治疗组的血压分布
sns.boxplot(x='treatment', y='blood_pressure', data=df)
plt.show()
```

---

## 0.3 数据加载与探索

在阶段 0，我们会先用 **内置数据集** 练手，然后学会加载**医学公共数据集**。

---

### 0.3.1 使用 DoWhy 内置 Lalonde 数据集

这个数据集是因果推断领域的经典教学案例，模拟了**职业培训对收入的因果影响**，和临床试验的结构类似（有治疗组和对照组）。

```python
import dowhy.datasets

# 加载数据
data = dowhy.datasets.linear_dataset(
    beta=10,  # 处理效应大小
    num_common_causes=5,  # 混杂变量个数
    num_instruments=1,    # 工具变量个数
    num_samples=1000, 
    treatment_is_binary=True
)

df = data["df"]
print(df.head())
```

输出示例：

```
   v0        v1    v2    v3    v4  z0  treatment     y
0  0.5  1.232  -0.3  0.77  1.20  0.2         1  15.32
...
```

这里：

* `treatment`：是否接受干预（如是否服药）
* `y`：结果变量（如收入、血压变化）
* `v0`-`v4`：混杂变量
* `z0`：工具变量

---

### 0.3.2 获取免费医学数据集

#### **(1) UCI Heart Disease 数据集**

* **用途**：可用于评估治疗（如药物、手术）对心脏病风险的因果影响
* **下载链接**：[UCI Heart Disease](https://archive.ics.uci.edu/ml/datasets/heart+Disease)
* **加载示例**：

```python
url = "https://raw.githubusercontent.com/selva86/datasets/master/Heart.csv"
df = pd.read_csv(url)
print(df.head())
```

---

#### **(2) MIMIC-IV（重症监护病人数据）**

* **用途**：真实 ICU 病人记录，可评估干预（药物、手术）对生存率影响
* **获取方式**：

  * 需在 [PhysioNet](https://physionet.org/content/mimiciv/2.2/) 注册并通过数据使用协议
  * 下载后用 `pandas.read_csv()` 加载
* **加载示例**：

```python
df = pd.read_csv("mimiciv_subset.csv")  # 自己下载的子集
print(df.describe())
```

---

#### **(3) SEER 癌症注册数据**

* **用途**：做癌症治疗效果与生存分析
* **获取方式**：需在 [SEER](https://seer.cancer.gov/data/) 申请访问
* **注意**：数据体量大，建议提取部分字段做因果推断练习

---

## 0.4 医学数据探索要点（EDA for Causal Inference）

在因果推断中，EDA 重点不是预测精度，而是**发现混杂因子、偏倚、变量分布**。

```python
# 查看数据规模
print(df.shape)

# 检查缺失值
print(df.isnull().sum())

# 检查治疗组 vs 对照组差异
sns.boxplot(x='treatment', y='age', data=df)
plt.show()

# 交叉表（治疗 vs 性别）
print(pd.crosstab(df['treatment'], df['sex']))
```

**EDA 重点：**

1. **治疗组和对照组基线差异** → 是否存在明显混杂
2. **变量分布** → 是否需要标准化、转换
3. **缺失数据模式** → 是否随机缺失（MCAR）、是否需填补

---

## 阶段 0 总结

到阶段 0 结束时，你应该能够：

* 搭建 Python 环境并安装因果推断相关包
* 熟悉数据读取、清洗、基本可视化
* 能加载至少 1 个医学数据集（如 UCI Heart Disease）
* 对数据进行因果推断前的初步探索（EDA）

---

我建议下一步在**阶段 1**直接用 **Lalonde 数据集** 做第一个 ATE（平均治疗效应）估计案例，这样一天就能从“数据 → 因果结论”跑通一次完整流程。
如果你愿意，我可以帮你把**阶段 1**写成一个**完整可运行的 Jupyter Notebook**，直接用 Python 跑出医学因果推断的第一个结果。这样你就马上能进入实战模式。

你要我帮你写这个可运行的阶段 1 Notebook 吗？这样可以无缝衔接阶段 0。
