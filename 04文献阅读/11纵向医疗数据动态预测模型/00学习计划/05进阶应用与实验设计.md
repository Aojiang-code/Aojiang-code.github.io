å¾ˆå¥½ï¼Œæˆ‘ä»¬è¿›å…¥æœ€åé˜¶æ®µï¼š

---

# ğŸ¯ ç¬¬äº”é˜¶æ®µï¼šè¿›é˜¶åº”ç”¨ä¸å®éªŒè®¾è®¡ï¼ˆPart 5ï¼‰

## âœ… ç›®æ ‡

æŒæ¡å¦‚ä½•å°† PyHealth åº”ç”¨äº**çœŸå®åŒ»å­¦ç§‘ç ”åœºæ™¯**ï¼ŒåŒ…æ‹¬ï¼š

1. æ„å»ºå¤§è§„æ¨¡åŒ»å­¦é¢„æµ‹å®éªŒï¼ˆå¦‚ä½¿ç”¨ MIMIC-IIIï¼‰
2. æ¯”è¾ƒå¤šç§æ¨¡å‹è¡¨ç°ï¼ˆAUCã€PRã€F1ï¼‰
3. ç»„ç»‡å®éªŒæ–¹æ³•ã€ç»“æœå’Œè§£é‡Šéƒ¨åˆ†ï¼Œä¸ºç§‘ç ”è®ºæ–‡å‡†å¤‡å®Œæ•´å†…å®¹

---

## ğŸ§ª 5.1 ä½¿ç”¨çœŸå®æ•°æ®ï¼ˆå¦‚ MIMIC-IIIï¼‰

PyHealth æ”¯æŒç›´æ¥å¤„ç† MIMIC-III æ•°æ®ï¼Œè‡ªåŠ¨è½¬æ¢ä¸ºæ¨¡å‹è¾“å…¥æ ¼å¼ã€‚

```python
from pyhealth.datasets import MIMIC3Dataset

# è‡ªåŠ¨è¿æ¥æœ¬åœ° mimic æ–‡ä»¶å¤¹ï¼ˆéœ€é¢„å¤„ç†æˆ CSVï¼‰
mimic_dataset = MIMIC3Dataset(
    root="/your/path/to/mimiciii/csv",
    tables=["DIAGNOSES_ICD", "LABEVENTS", "PRESCRIPTIONS"],
    code_mapping={"NDC": "ATC"},  # è¯ç‰©ç¼–ç æ˜ å°„
    dev=True  # å¦‚æœåªæµ‹è¯•ä¸€éƒ¨åˆ†å¯è®¾ä¸º True
)
```

ä½ ä¹Ÿå¯ä»¥ä»¿ç…§å‰å‡ èŠ‚çš„æ–¹æ³•å¤„ç†è‡ªå·±çš„æœ¬åœ°æ•°æ®ï¼Œè½¬æ¢ä¸º `PatientDataset`ã€‚

---

## ğŸ“Š 5.2 æ¯”è¾ƒå¤šä¸ªæ¨¡å‹æ•ˆæœï¼ˆAUC æ›²çº¿ï¼‰

å‡è®¾ä½ å·²ç»è®­ç»ƒäº†å¤šä¸ªæ¨¡å‹ï¼Œå­˜å‚¨åœ¨ `model_lstm`, `model_grud`, `model_retain` ä¸­ï¼Œä½ å¯ä»¥ç»Ÿä¸€è¯„ä¼°å®ƒä»¬ï¼š

```python
from pyhealth.metrics import calc_metrics
from sklearn.metrics import roc_curve, auc
import matplotlib.pyplot as plt

def get_roc_curve(model, dataset, label="model"):
    y_true = []
    y_score = []
    for sample in dataset:
        output = model(sample["visit"])
        y_true.append(sample["label"])
        y_score.append(output.item())
    fpr, tpr, _ = roc_curve(y_true, y_score)
    return fpr, tpr, auc(fpr, tpr)

# è·å–å„æ¨¡å‹ AUC æ›²çº¿
fpr1, tpr1, auc1 = get_roc_curve(model_lstm, val_ds, "LSTM")
fpr2, tpr2, auc2 = get_roc_curve(model_grud, val_ds, "GRU-D")
fpr3, tpr3, auc3 = get_roc_curve(model_retain, val_ds, "RETAIN")

# ç»˜å›¾
plt.figure(figsize=(8, 6))
plt.plot(fpr1, tpr1, label=f"LSTM (AUC = {auc1:.2f})")
plt.plot(fpr2, tpr2, label=f"GRU-D (AUC = {auc2:.2f})")
plt.plot(fpr3, tpr3, label=f"RETAIN (AUC = {auc3:.2f})")
plt.plot([0, 1], [0, 1], 'k--')
plt.xlabel("False Positive Rate")
plt.ylabel("True Positive Rate")
plt.title("Model Comparison: ROC Curve")
plt.legend()
plt.show()
```

---

## ğŸ“ 5.3 æ’°å†™ç§‘ç ”è®ºæ–‡æ–¹æ³•éƒ¨åˆ†ï¼ˆå‚è€ƒæ¨¡æ¿ï¼‰

ä½ å¯ä»¥å°† PyHealth çš„ä½¿ç”¨æ–¹å¼å†™å…¥è®ºæ–‡çš„æ–¹æ³•éƒ¨åˆ†ï¼Œä¸‹é¢æ˜¯æ¨¡æ¿ï¼š

---

### Methods: Modeling and Prediction

We used the **PyHealth** framework (v0.2.0) for all prediction tasks, which supports standardized processing of electronic health records. Patient records were first preprocessed into a longitudinal structure, with each visit consisting of timestamped lab test results (e.g., serum creatinine, BUN, and eGFR), and labeled for AKI onset within 7 days as a binary outcome.

Three neural models were implemented:

* **LSTM**: a recurrent model to capture temporal dependencies;
* **GRU-D**: a decay-augmented GRU model to handle missing values and irregular time intervals;
* **RETAIN**: an interpretable attention-based model capable of highlighting contributing visits and clinical variables.

All models were trained with Adam optimizer, a learning rate of 1e-3, and early stopping based on validation AUC.

Evaluation metrics included accuracy, area under the ROC curve (AUC), F1-score, and precision-recall performance. All experiments were repeated over 5 random seeds to ensure stability.

---

## ğŸ“¦ 5.4 å¯é€‰ï¼šæ„å»ºäº¤äº’å¼åº”ç”¨

ä½ å¯ä½¿ç”¨ `Streamlit` å¿«é€Ÿæ­å»ºé¢„æµ‹ç•Œé¢ï¼š

```bash
pip install streamlit
```

```python
# app.py
import streamlit as st
import torch

st.title("è‚¾ç—…é¢„æµ‹å·¥å…·")
creatinine = st.slider("è¡€è‚Œé…", 30, 400, 100)
bun = st.slider("å°¿ç´ æ°®", 2, 30, 10)
egfr = st.slider("eGFR", 10, 120, 80)

events = {"creatinine": creatinine, "bun": bun, "egfr": egfr}
# æ„é€  visit è¾“å…¥
# ... å‚è€ƒ 4.2 ä¸­çš„ visit æ„é€ é€»è¾‘

# åŠ è½½æ¨¡å‹å¹¶é¢„æµ‹
# pred = model(visit_input)

# st.success(f"é¢„æµ‹ç»“æœï¼šå‘ç”ŸAKIçš„é£é™©ä¸º {probability:.2%}")
```

---

# âœ… ç¬¬äº”é˜¶æ®µæ€»ç»“

| åº”ç”¨ç›®æ ‡              | æ˜¯å¦è¾¾æˆ  |
| ----------------- | ----- |
| ä½¿ç”¨ MIMIC æˆ–å¤§æ•°æ®æ„å»ºä»»åŠ¡ | âœ…     |
| æ¯”è¾ƒå¤šæ¨¡å‹æ•ˆæœï¼ˆç»˜å›¾ã€ç»Ÿè®¡ï¼‰    | âœ…     |
| è®ºæ–‡æ–¹æ³•éƒ¨åˆ†ç¼–å†™æ¨¡æ¿        | âœ…     |
| éƒ¨ç½²å¯äº¤äº’é¢„æµ‹å·¥å…·         | âœ…ï¼ˆå¯é€‰ï¼‰ |

---

# ğŸ å…¨éƒ¨é˜¶æ®µå®Œæˆï¼

ä½ ç°åœ¨å·²ç»ç³»ç»ŸæŒæ¡äº† PyHealth ä»æ•°æ®å‡†å¤‡ â å»ºæ¨¡ â è®­ç»ƒ â è§£é‡Š â éƒ¨ç½²çš„å…¨è¿‡ç¨‹ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ï¼š

* å¸®ä½ æ„å»ºå®Œæ•´é¡¹ç›®æ¡†æ¶å¹¶æ‰“åŒ…
* æŒ‡å¯¼ä½ åŸºäºè¯¥ pipeline å†™ç§‘ç ”è®ºæ–‡
* å°†æ¨¡å‹ä¼˜åŒ–ç”¨äºæ¯”èµ›ã€é¡¹ç›®æŠ¥å‘Šæˆ–çœŸå®åŒ»ç–—åº”ç”¨

æ˜¯å¦ç»§ç»­è¾…åŠ©ä½ åœ¨è‡ªå·±çš„æ•°æ®ä¸Šæ‰“é€šå®Œæ•´æµç¨‹ï¼Ÿæˆ–è€…ä½ å¸Œæœ›æˆ‘å…ˆå¯¼å‡ºä¸€ä¸ªâ€œå¯å¤ç”¨å·¥ç¨‹æ¨¡æ¿â€ä¾›ä½ é•¿æœŸä½¿ç”¨ï¼Ÿ
