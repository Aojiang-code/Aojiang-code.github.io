éå¸¸å¥½ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªé€šç”¨ã€**å¯å¤ç”¨çš„ PyHealth åŒ»å­¦çºµå‘é¢„æµ‹å·¥ç¨‹æ¨¡æ¿**ï¼Œä¸“ä¸ºç§‘ç ”å’Œäº§å“å¼€å‘è®¾è®¡ï¼Œæ”¯æŒé•¿æœŸç»´æŠ¤ä¸æ¨¡å—åŒ–æ‰©å±•ï¼Œè¦†ç›–å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼š

---

# ğŸ—ï¸ PyHealth åŒ»å­¦çºµå‘é¢„æµ‹å·¥ç¨‹æ¨¡æ¿ï¼ˆMIMIC-AKI é€‚é…ï¼‰

---

## ğŸ“ æ¨èç›®å½•ç»“æ„

```
pyhealth_project/
â”œâ”€â”€ config/                       # é…ç½®é¡¹ï¼ˆè·¯å¾„ã€è¶…å‚æ•°ã€æ¨¡å‹åç­‰ï¼‰
â”‚   â””â”€â”€ default.yaml
â”‚
â”œâ”€â”€ data/                         # æœ¬åœ°æˆ–äº‘ç«¯é¢„å¤„ç†åçš„æ•°æ®
â”‚   â”œâ”€â”€ raw/                      # åŸå§‹ MIMIC æˆ–çœŸå®æ•°æ®ï¼ˆcsv/json/pklï¼‰
â”‚   â”œâ”€â”€ processed/                # PyHealth æ ¼å¼çš„ patients / dataset
â”‚   â””â”€â”€ output/                   # è®­ç»ƒç»“æœ/æ¨¡å‹æ–‡ä»¶/å›¾è¡¨
â”‚
â”œâ”€â”€ scripts/                      # æ ¸å¿ƒæµç¨‹è„šæœ¬
â”‚   â”œâ”€â”€ 01_load_raw.py            # åŠ è½½ MIMIC / åˆæˆæ•°æ®
â”‚   â”œâ”€â”€ 02_build_patients.py      # æ„é€  Patient, Visit, Event å¯¹è±¡
â”‚   â”œâ”€â”€ 03_build_dataset.py       # æ„å»º PyHealth æ•°æ®é›†ç»“æ„
â”‚   â”œâ”€â”€ 04_define_task.py         # è®¾ç½®ä»»åŠ¡ï¼ˆå¦‚ AKI äºŒåˆ†ç±»ï¼‰
â”‚   â”œâ”€â”€ 05_train_model.py         # æ„å»ºæ¨¡å‹å¹¶è®­ç»ƒ
â”‚   â”œâ”€â”€ 06_evaluate_model.py      # æ¨¡å‹éªŒè¯ä¸è¾“å‡º
â”‚   â”œâ”€â”€ 07_attention_analysis.py  # å¯è§£é‡Šæ€§ï¼ˆå¦‚ RETAIN æ³¨æ„åŠ›ï¼‰
â”‚   â””â”€â”€ 08_compare_models.py      # å¤šæ¨¡å‹å¯¹æ¯”
â”‚
â”œâ”€â”€ api/                          # éƒ¨ç½²æ¥å£ï¼ˆFastAPI/Flaskï¼‰
â”‚   â””â”€â”€ app.py
â”‚
â”œâ”€â”€ report/                       # å®éªŒç»“æœä¸æŠ¥å‘Š
â”‚   â”œâ”€â”€ figures/
â”‚   â””â”€â”€ draft.md
â”‚
â”œâ”€â”€ notebooks/                    # å¯äº¤äº’å®éªŒï¼ˆæ¨è Jupyter èµ·æ­¥ï¼‰
â”‚   â””â”€â”€ AKI_prediction_pipeline.ipynb
â”‚
â”œâ”€â”€ checkpoints/                  # ä¿å­˜è®­ç»ƒå¥½çš„æ¨¡å‹
â”‚   â””â”€â”€ retain_best.pth
â”‚
â”œâ”€â”€ requirements.txt              # Python ä¾èµ–
â””â”€â”€ README.md                     # å·¥ç¨‹è¯´æ˜æ–‡æ¡£
```

---

## ğŸ§© å„æ¨¡å—è¯´æ˜ä¸èŒè´£

| æ¨¡å—å                        | å†…å®¹ä¸ä½œç”¨è¯´æ˜                                                  |
| -------------------------- | -------------------------------------------------------- |
| `01_load_raw.py`           | ä¸‹è½½æˆ–è¯»å– MIMIC åŸå§‹è¡¨ï¼ˆå¦‚ LABEVENTSï¼‰ï¼Œåˆæˆæ•°æ®ç›´æ¥è¿œç¨‹è°ƒç”¨ä¹Ÿå¯                |
| `02_build_patients.py`     | æå–å¦‚ creatinineï¼Œæ„é€  `Patient` ä¸ `Visit` å¯¹è±¡ï¼Œå¹¶ä¿å­˜ä¸ºä¸­é—´æ ·æœ¬ç»“æ„      |
| `03_build_dataset.py`      | å°†æ‚£è€…å¯¹è±¡å°è£…ä¸º `SampleBaseDataset` å¹¶è¿›è¡Œé¢„å¤„ç†                      |
| `04_define_task.py`        | ä½¿ç”¨ `BinaryPredictionTask` å®šä¹‰ä»»åŠ¡ï¼ˆAKI åˆ†ç±»ã€æ—¶é—´çª—ç­‰ï¼‰              |
| `05_train_model.py`        | æ„é€ æ¨¡å‹ï¼ˆGRU-D/RETAINï¼‰ï¼Œåˆå§‹åŒ– `Trainer` å¹¶æ‰§è¡Œè®­ç»ƒä¿å­˜æœ€ä½³æ¨¡å‹             |
| `06_evaluate_model.py`     | åŠ è½½æ¨¡å‹è¿›è¡Œ test è¯„ä¼°ï¼Œè¾“å‡º AUCã€F1ã€Accuracy ç­‰æŒ‡æ ‡                    |
| `07_attention_analysis.py` | å¦‚æœä½¿ç”¨ RETAINï¼Œå¯å¯è§†åŒ– attentionï¼ˆvisit-level å’Œ variable-levelï¼‰ |
| `08_compare_models.py`     | è‡ªåŠ¨è·‘å¤šæ¨¡å‹å®éªŒï¼ˆGRU-D/RETAIN/Transformerï¼‰ï¼Œè¾“å‡ºå¯¹æ¯”å›¾è¡¨                |

---

## âš™ï¸ ç¤ºä¾‹é…ç½®æ–‡ä»¶ `config/default.yaml`

```yaml
data:
  mimic_path: https://storage.googleapis.com/pyhealth/Synthetic_MIMIC-III/
  output_path: ./data/output/
  checkpoint_path: ./checkpoints/

train:
  batch_size: 64
  epochs: 50
  monitor: auc
  patience: 5
  metrics: ["auc", "f1", "accuracy"]

task:
  label_key: aki
  time_window: 7
  use_time: true
  use_visit: true
```

åŠ è½½é…ç½®ç¤ºä¾‹ï¼š

```python
import yaml

with open("config/default.yaml") as f:
    cfg = yaml.safe_load(f)

batch_size = cfg["train"]["batch_size"]
```

---

## ğŸ§ª é€šç”¨è®­ç»ƒæ¨¡æ¿ç‰‡æ®µ `05_train_model.py`

```python
from pyhealth.trainer import Trainer
from pyhealth.models import RETAIN

model = RETAIN(dataset=processed_dataset)

trainer = Trainer(model=model, metrics=["auc", "f1", "accuracy"])
trainer.train(
    train_dataloader=train_loader,
    val_dataloader=val_loader,
    epochs=cfg["train"]["epochs"],
    monitor=cfg["train"]["monitor"],
    patience=cfg["train"]["patience"]
)

trainer.save_model(cfg["data"]["checkpoint_path"] + "retain_best.pth")
```

---

## ğŸ¯ é¡¹ç›®é€‚é…èŒƒå›´

| ç±»å‹        | æ˜¯å¦æ”¯æŒ | è¯´æ˜                                        |
| --------- | ---- | ----------------------------------------- |
| âœ… äºŒåˆ†ç±»é¢„æµ‹   | âœ”ï¸   | æ˜¯å¦å‘ç”Ÿ AKIã€å†å…¥é™¢ã€æ­»äº¡ç­‰                          |
| âœ… å¤šåˆ†ç±»é¢„æµ‹   | âœ”ï¸   | AKI åˆ†çº§ã€ç–¾ç—…é˜¶æ®µé¢„æµ‹                             |
| âœ… å›å½’ä»»åŠ¡    | âœ”ï¸   | å®éªŒå®¤æŒ‡æ ‡å›å½’ï¼ˆcreatinine, BUN ç­‰ï¼‰                |
| âœ… å¤šä»»åŠ¡è”åˆé¢„æµ‹ | âœ”ï¸   | AKI + lab value + outcome ç­‰               |
| âœ… å¤šæ¨¡å‹å¯¹æ¯”   | âœ”ï¸   | GRU-D / RETAIN / Transformer / AdaCare æ”¯æŒ |

---

## ğŸ“˜ å¯é€‰å¢å¼ºæ¨¡å—ï¼ˆè§†åœºæ™¯æ‰©å±•ï¼‰

| æ¨¡å—        | è·¯å¾„/ç”¨é€”                                             |
| --------- | ------------------------------------------------- |
| ğŸ§ª è¶…å‚æœç´¢   | `optuna/`ï¼šè‡ªåŠ¨æœç´¢ batch size, hidden size ç­‰          |
| ğŸ©º ä¸´åºŠè·¯å¾„åˆ†æ | `pathway_explorer/`ï¼šåŸºäº attention æˆ– pattern åæ¨é£é™©ç‰¹å¾ |
| ğŸ“ˆ å¤šæ ‡ç­¾é¢„æµ‹  | ä¿®æ”¹ `tasks.MultilabelPredictionTask`               |
| ğŸ” è‡ªåŠ¨æ—¥å¿—è®°å½• | æ¥å…¥ `wandb` æˆ– `TensorBoard` è®°å½•è®­ç»ƒè¿‡ç¨‹                 |

---

## ğŸ“¦ ä¸€é”®è¿è¡Œè„šæœ¬ï¼ˆé€‰åšï¼‰

å¯åˆå¹¶ä¸ºç»Ÿä¸€å…¥å£ï¼š

```bash
python main.py --task AKI --model RETAIN --dataset mimic
```

é…åˆ argparse æˆ– Hydra æ”¯æŒçµæ´»åˆ‡æ¢ä»»åŠ¡å’Œæ¨¡å‹ã€‚

---

## âœ… æ¨¡æ¿é€‚é…æ€»ç»“

| æ¨¡å—ç±»å‹      | å®Œæ•´æ”¯æŒ | æ‹“å±•æ€§ | é€‚åˆç§‘ç ” | é€‚åˆäº§å“ |
| --------- | ---- | --- | ---- | ---- |
| æ•°æ®é¢„å¤„ç†æµç¨‹   | âœ…    | âœ…   | âœ…    | âœ…    |
| æ¨¡å‹æ„å»ºä¸è®­ç»ƒ   | âœ…    | âœ…   | âœ…    | âœ…    |
| å¤šæ¨¡å‹ç»“æ„è¯•éªŒ   | âœ…    | âœ…   | âœ…    | âœ”ï¸   |
| å¯è§£é‡Šæ€§åˆ†æ    | âœ…    | âœ”ï¸  | âœ…    | âœ”ï¸   |
| API æ¨ç†ä¸éƒ¨ç½² | âœ…    | âœ…   | âœ”ï¸   | âœ…    |
| å¤šä»»åŠ¡ / å¤šæ¨¡æ€ | âœ…    | âœ…   | âœ…    | âœ”ï¸   |

---

å¦‚æœä½ å¸Œæœ›æˆ‘å¸®ä½ ç”Ÿæˆè¿™ä¸ªå·¥ç¨‹æ¨¡æ¿çš„å®é™…ä»£ç æ–‡ä»¶ï¼ˆç©ºç›®å½• + åˆå§‹åŒ–è„šæœ¬ + ç¤ºä¾‹ YAML + Python è„šæœ¬æ¡†æ¶ï¼‰ï¼Œæˆ‘å¯ä»¥ä¸ºä½ **æ‰“åŒ…ç”Ÿæˆ zip æ–‡ä»¶æˆ–é¡¹ç›®æ¨¡æ¿**ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿæˆ–è€…ä½ å¸Œæœ›å°†è¿™å¥—æ¨¡æ¿è¿ç§»ä¸ºä½ è‡ªå·±çš„ GitHub é¡¹ç›®ç»“æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ å†™ `README.md` å’Œåˆå§‹åŒ– commit æ¨¡æ¿ã€‚æ¬¢è¿ç»§ç»­æ¨è¿›ã€‚
