å¥½çš„ï¼Œä¸‹é¢æ˜¯å®Œæ•´çš„ **ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®å‡†å¤‡ä¸è½¬æ¢ï¼ˆMIMIC-AKI åœºæ™¯ï¼‰** å®æ“å­¦ä¹ è®¡åˆ’ï¼Œä¸“ä¸ºæ„å»ºè‚¾ç—…/AKI é¢„æµ‹ä»»åŠ¡è€Œè®¾è®¡ï¼Œæ¶µç›–ä»æ•°æ®åŠ è½½ â æ ‡ç­¾å®šä¹‰ â æ„å»ºæ ·æœ¬ â æ•°æ®é›†å°è£…çš„å…¨æµç¨‹ä»£ç ä¸æ–¹æ³•ã€‚

---

# ğŸ“š ç¬¬äºŒé˜¶æ®µï¼šæ•°æ®å‡†å¤‡ä¸è½¬æ¢ï¼ˆMIMIC-AKI åœºæ™¯ï¼‰

---

## ğŸ¯ é˜¶æ®µç›®æ ‡

1. æˆåŠŸä» Synthetic MIMIC ä¸­æå–å…³é”®å®éªŒå®¤äº‹ä»¶ï¼ˆå¦‚ creatinineï¼‰ï¼›
2. æ„é€  AKI äºŒåˆ†ç±»æ ‡ç­¾ï¼ˆå¦‚ 7 å¤©å†…æ˜¯å¦è¿›å±•ä¸º AKIï¼‰ï¼›
3. æ„å»º `Patient` å’Œ `Visit` å¯¹è±¡ï¼Œå¡«å……ä¸º PyHealth æ•°æ®ç»“æ„ï¼›
4. å°è£…ä¸º `SampleBaseDataset`ï¼Œä¸ºåç»­è®­ç»ƒåšå¥½å‡†å¤‡ã€‚

---

## â± æ¨èç”¨æ—¶ï¼š1â€“2 å¤©

---

## ğŸ§¾ å‡è®¾ä»»åŠ¡å®šä¹‰

* ä»»åŠ¡ç±»å‹ï¼š**äºŒåˆ†ç±»**
* æ ‡ç­¾å®šä¹‰ï¼šè‹¥æœªæ¥ 7 å¤©å†… creatinine > 1.5 mg/dL åˆ™è§†ä¸º AKI = 1ï¼›å¦åˆ™ AKI = 0
* æ•°æ®æ¥æºï¼šSynthetic MIMIC-III ä¸­çš„ `LABEVENTS` è¡¨

---

## ğŸ“Œ æ­¥éª¤ä¸€ï¼šè½½å…¥ LABEVENTS è¡¨å¹¶è¿‡æ»¤è‚Œé…äº‹ä»¶

```python
from pyhealth.datasets import MIMIC3Dataset

dataset = MIMIC3Dataset(
    root="https://storage.googleapis.com/pyhealth/Synthetic_MIMIC-III/",
    tables=["LABEVENTS"]
)

creatinine_code = "50912"  # MIMIC ä¸­ä»£è¡¨è¡€è‚Œé…çš„ itemid

creatinine_events = []
for patient in dataset.patients:
    for visit in patient.visits:
        for event in visit.get_events("lab"):
            if event.code == creatinine_code:
                creatinine_events.append({
                    "patient_id": patient.patient_id,
                    "visit_id": visit.visit_id,
                    "time": event.timestamp,
                    "value": float(event.value)
                })
```

---

## ğŸ“Œ æ­¥éª¤äºŒï¼šæ„å»ºæ ·æœ¬ä¸ AKI æ ‡ç­¾

```python
from datetime import timedelta
from pyhealth.data import Patient, Visit, Event
from pyhealth.datasets import SampleBaseDataset

patient_objects = []

# åˆ›å»ºç—…äººå¯¹è±¡ï¼ˆæ¯ä½ç—…äººç‹¬ç«‹æ„é€ ï¼‰
for patient in dataset.patients:
    p = Patient(patient_id=patient.patient_id, data_source="mimic")
    for v in patient.visits:
        visit = Visit(visit_id=v.visit_id, patient_id=p.patient_id, encounter_time=v.encounter_time)
        has_creatinine = False
        for e in v.get_events("lab"):
            if e.code == creatinine_code:
                has_creatinine = True
                visit.add_event("lab", e.timestamp, {"test": "creatinine", "value": float(e.value)})

        if has_creatinine:
            p.add_visit(visit)
    if len(p.visits) > 0:
        patient_objects.append(p)
```

ğŸ“Œ å¯é€‰ï¼ˆæ„é€  AKI æ ‡ç­¾ï¼‰ï¼š
æˆ‘ä»¬é»˜è®¤ï¼šè‹¥åœ¨ä»»ä½•å°±è¯Šåçš„ 7 å¤©å†…è‚Œé…å€¼ > 1.5ï¼Œåˆ™æ ‡ç­¾ = 1

```python
for p in patient_objects:
    for visit in p.visits:
        label = 0
        t0 = visit.encounter_time
        for future_visit in p.visits:
            dt = (future_visit.encounter_time - t0).days
            if 0 < dt <= 7:
                for e in future_visit.get_events("lab"):
                    if e.code == creatinine_code and float(e.value) > 1.5:
                        label = 1
        visit.add_event("label", t0, {"aki": label})
```

---

## ğŸ“Œ æ­¥éª¤ä¸‰ï¼šå°è£…ä¸º SampleBaseDataset

```python
custom_dataset = SampleBaseDataset(
    root=".",
    samples=patient_objects,
    dataset_name="AKI_LAB"
)
```

æ£€æŸ¥æ ·æœ¬ï¼š

```python
custom_dataset.stat()
print(custom_dataset.patients[0].visits[0].get_events("lab"))
print(custom_dataset.patients[0].visits[0].get_events("label"))
```

---

## ğŸ“‚ å»ºè®®ç›®å½•ç»“æ„

```
pyhealth_project/
â”œâ”€â”€ data/
â”‚   â””â”€â”€ aki_sample_patients.pkl         # å¯é€‰ï¼šä¿å­˜ä¸­é—´æ ·æœ¬
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ 01_extract_creatinine.py        # è‚Œé…äº‹ä»¶æå–
â”‚   â”œâ”€â”€ 02_construct_patients.py        # æ„å»ºæ‚£è€… + æ ‡ç­¾
â”‚   â””â”€â”€ 03_build_dataset.py             # å°è£…ä¸º PyHealth Dataset
```

---

## âœ… é˜¶æ®µå®Œæˆæ ‡å‡†

| æ£€æŸ¥ç‚¹                         | æ˜¯å¦å®Œæˆ |
| --------------------------- | ---- |
| æˆåŠŸæå–è‚Œé… lab äº‹ä»¶               | âœ…    |
| æ„å»º `Patient` ä¸ `Visit` ç»“æ„   | âœ…    |
| æ·»åŠ  AKI æ ‡ç­¾äº‹ä»¶                 | âœ…    |
| æ„é€  PyHealth Dataset å¹¶æˆåŠŸæ‰“å°æ ·æœ¬ | âœ…    |

---

## ğŸ“˜ æ¨èç»ƒä¹ 

ä½ å¯ä»¥å°è¯•ï¼š

* âœ… ä»¥ `BUN` ä¸ºç›®æ ‡å®éªŒå®¤æŒ‡æ ‡ï¼Œé‡å¤æ„å»ºè¿‡ç¨‹ï¼›
* âœ… è‡ªå®šä¹‰æ ‡ç­¾é˜ˆå€¼ï¼ˆå¦‚è‚Œé… > 2.0ï¼‰å¹¶è§‚å¯Ÿé¢„æµ‹éš¾åº¦ï¼›
* âœ… æ„é€ ä¸åŒæ—¶çª—æ ‡ç­¾ï¼ˆ3å¤© vs 7å¤© vs 14å¤©ï¼‰è¿›è¡Œå¯¹æ¯”ã€‚

---

æ˜¯å¦ç»§ç»­è¿›å…¥ç¬¬ä¸‰é˜¶æ®µã€å»ºæ¨¡ä¸è®­ç»ƒï¼ˆæ¨¡å‹æ„å»º + ä»»åŠ¡å®šä¹‰ + Trainer è®­ç»ƒï¼‰ã€‘ï¼Ÿ
æˆ‘å¯ä»¥ä¸ºä½ å†™å‡ºå®Œæ•´å¯è¿è¡Œçš„æ¨¡å‹è®­ç»ƒè„šæœ¬æ¨¡æ¿ï¼ˆé€‚é…ä½ åˆšæ‰æ„å»ºçš„æ•°æ®ï¼‰ã€‚æ˜¯å¦ç»§ç»­ï¼Ÿ
