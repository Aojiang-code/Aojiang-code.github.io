éå¸¸å¥½ï¼Œæˆ‘ä»¬ç°åœ¨è¿›å…¥ï¼š

---

# ğŸ“ ç¬¬äºŒé˜¶æ®µï¼šæ„å»º AKI æ ‡ç­¾ + æå– ICU å…¥ç§‘å 24 å°æ—¶å†…ç‰¹å¾

> ç›®æ ‡æ˜¯æ„å»ºä¸€ä¸ªæ ·æœ¬ä¸ºè¡Œã€ç‰¹å¾ä¸ºåˆ—ã€å« AKI æ ‡ç­¾çš„å»ºæ¨¡æ•°æ®é›†
> ä¸¥æ ¼æŒ‰ç…§è®ºæ–‡ã€ŠPredicting the risk factors of DKA-associated AKIã€‹çš„æ–¹æ³•è¿›è¡Œ

---

## âœ… ç¬¬äºŒé˜¶æ®µæ•´ä½“ä»»åŠ¡æ‹†è§£å¦‚ä¸‹ï¼š

| æ­¥éª¤  | ä»»åŠ¡                                      | æ‰€éœ€è¡¨æ ¼                       |
| --- | --------------------------------------- | -------------------------- |
| 2.1 | æ„å»º AKI æ ‡ç­¾ï¼ˆåŸºäº KDIGO æ ‡å‡†ï¼‰                  | `labevents`, `chartevents` |
| 2.2 | æå– ICU å…¥ç§‘å 24 å°æ—¶å†…å®éªŒå®¤æŒ‡æ ‡                  | `labevents`, `d_labitems`  |
| 2.3 | æå– ICU å…¥ç§‘å 24 å°æ—¶å†…ç”Ÿå‘½ä½“å¾ï¼ˆå°¿é‡ã€HRã€RRã€SBPã€DBPï¼‰ | `chartevents`, `d_items`   |
| 2.4 | åˆå¹¶ä¸ºå»ºæ¨¡æ•°æ®é›† `final_df`                     | ä¸Šè¿°å„è¡¨                       |

---

## ğŸ”§ ç¯å¢ƒå‰æ

è¯·æ‚¨å·²åŠ è½½ä»¥ä¸‹æ–‡ä»¶ï¼ˆæˆ–å‡†å¤‡å¥½è·¯å¾„ï¼‰ï¼š

```python
labevents = pd.read_csv('/public/home/aojiang/mimic/hosp/labevents.csv')
chartevents = pd.read_csv('/public/home/aojiang/mimic/icu/chartevents.csv')
d_items = pd.read_csv('/public/home/aojiang/mimic/hosp/d_items.csv')  # åŒ…å« itemid å’Œ label æ˜ å°„
```

---

## ğŸ”¶ 2.1 æ„å»º AKI æ ‡ç­¾ï¼ˆåŸºäº KDIGOï¼‰

æˆ‘ä»¬é‡‡ç”¨è®ºæ–‡é»˜è®¤æ–¹å¼ï¼š**æ ¹æ® Serum Creatinineï¼ˆScrï¼‰+ Urine output åˆ¤å®š AKI**
ï¼ˆä»¥ ICU å…¥ç§‘å 7 å¤©å†…ä¸ºè¯„ä¼°çª—å£ï¼‰

### ğŸ“Œ æ–¹æ³•ï¼š

* Scr å‡é«˜ â‰¥ 0.3 mg/dL within 48h
* æˆ– Scr å‡é«˜ â‰¥ 1.5 Ã— baseline within 7 days
* æˆ– å°¿é‡æŒç»­ < 0.5 ml/kg/h è¶…è¿‡ 6 å°æ—¶ï¼ˆå¯é€‰ï¼‰

---

### âœ… æ­¥éª¤ 1ï¼šè·å– Scr çš„ itemid

```python
# å¯»æ‰¾ Scr é¡¹ç›®çš„ itemidï¼ˆé€šå¸¸ä¸º 50912ï¼‰
scr_items = d_items[d_items['label'].str.contains('creatinine', case=False)]
print(scr_items[['itemid', 'label']])
```

è¾“å‡ºç¡®è®¤åï¼Œä¾‹å¦‚ç”¨ `50912`ï¼š

---

### âœ… æ­¥éª¤ 2ï¼šæå– Scr å€¼

```python
scr_itemid = 50912

# ICUå†… 7å¤©å†… Scr è®°å½•
scr_data = labevents[
    (labevents['itemid'] == scr_itemid) &
    (labevents['hadm_id'].isin(dka_df['hadm_id']))
].copy()

# æ—¶é—´æ ¼å¼è½¬æ¢
scr_data['charttime'] = pd.to_datetime(scr_data['charttime'])

# åˆå¹¶ ICU å…¥ç§‘æ—¶é—´ï¼ˆç”¨äºçª—å£è®¡ç®—ï¼‰
scr_data = scr_data.merge(
    dka_df[['subject_id', 'hadm_id', 'stay_id', 'intime']],
    on='hadm_id', how='left'
)

# ç­›é€‰ ICU å 7 å¤©å†… Scr
scr_data['hours_from_icu'] = (scr_data['charttime'] - pd.to_datetime(scr_data['intime'])).dt.total_seconds() / 3600
scr_data = scr_data[(scr_data['hours_from_icu'] >= 0) & (scr_data['hours_from_icu'] <= 168)]
```

---

### âœ… æ­¥éª¤ 3ï¼šæŒ‰æ‚£è€…åˆ†ç»„åˆ¤æ–­ AKIï¼ˆç®€åŒ–å®ç°ï¼‰

æˆ‘ä»¬å°†ä½¿ç”¨å¦‚ä¸‹ç­–ç•¥åˆ¤æ–­ï¼š

```python
# Step 1: è·å–æ¯ä½æ‚£è€…çš„åŸºçº¿å€¼ï¼ˆå‰12å°æ—¶æœ€å°å€¼ï¼‰+ æœ€å¤§å€¼ï¼ˆ48å°æ—¶å†…ï¼‰
aki_list = []

for stay_id, group in scr_data.groupby('stay_id'):
    baseline = group[group['hours_from_icu'] <= 12]['valuenum'].min()
    peak_48h = group[group['hours_from_icu'] <= 48]['valuenum'].max()

    if pd.notnull(baseline) and pd.notnull(peak_48h):
        if (peak_48h - baseline >= 0.3) or (peak_48h >= 1.5 * baseline):
            aki_list.append((stay_id, 1))
        else:
            aki_list.append((stay_id, 0))
    else:
        aki_list.append((stay_id, 0))  # æ— æ•°æ®é»˜è®¤0ï¼ˆä¹Ÿå¯è®¾NaNï¼‰

aki_df = pd.DataFrame(aki_list, columns=['stay_id', 'AKI'])
```

---

## ğŸ“Š å½“å‰äº§å‡ºï¼šAKI æ ‡ç­¾è¡¨

ç°åœ¨æˆ‘ä»¬å¾—åˆ°äº† `aki_df`ï¼Œå¯ä»¥ä¸ `dka_df` åˆå¹¶ï¼š

```python
dka_df = dka_df.merge(aki_df, on='stay_id', how='left')
```

---

## âœ… æ¥ä¸‹æ¥è¦åšçš„ï¼š

### ğŸ”¶ 2.2 æå– ICU å…¥ç§‘å 24 å°æ—¶å†…å®éªŒå®¤æŒ‡æ ‡

ï¼ˆå¦‚ï¼šBUNã€PLTã€WBCã€Gluã€Naã€K ç­‰ï¼‰

### ğŸ”¶ 2.3 æå– 24h å†…ç”Ÿå‘½ä½“å¾å’Œå¤„ç†å˜é‡

ï¼ˆå¦‚ï¼šå°¿é‡ã€HRã€RRã€SBPã€DBPï¼‰

æˆ‘å¯ä»¥å¸®æ‚¨ç»§ç»­å®Œæˆ**å˜é‡ç­›é€‰ï¼ˆå« itemidï¼‰+ æ•°æ®æå–ä¸é€è§† + åˆå¹¶è¿‡ç¨‹**ã€‚

è¯·ç¡®è®¤æ˜¯å¦ç»§ç»­è¿›å…¥ **ç¬¬ 2.2 æ­¥ï¼šæå– 24h å†…å®éªŒå®¤å˜é‡ï¼ˆBUNã€PLT ç­‰ï¼‰**ï¼Ÿæˆ‘å°†é™„å¸¦å…¨éƒ¨ itemid å¹¶æä¾›æ ‡å‡†åŒ–æå–å‡½æ•°ã€‚
