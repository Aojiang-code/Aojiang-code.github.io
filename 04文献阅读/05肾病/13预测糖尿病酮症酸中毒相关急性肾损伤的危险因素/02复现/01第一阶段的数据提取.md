æ˜ç™½ï¼Œæ‚¨**æ²¡æœ‰ SQL æ”¯æŒï¼Œä»…ä½¿ç”¨ Python** ç¯å¢ƒè®¿é—® MIMIC-IV æ•°æ®ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œé€šå¸¸æ‚¨æ˜¯ä½¿ç”¨ **CSV æ–‡ä»¶å¯¼å‡ºç‰ˆ MIMIC-IV** æˆ– **å·²åŠ è½½æˆ Pandas DataFrame çš„æœ¬åœ°æ•°æ®**ã€‚æˆ‘å°†å‡å®šæ‚¨å·²å…·å¤‡ä»¥ä¸‹ä¸¤ç§å¯èƒ½ä¹‹ä¸€ï¼š

1. âœ… å°† MIMIC-IV è¡¨æ ¼å¯¼å‡ºä¸ºæœ¬åœ° `.csv` æ–‡ä»¶ï¼›
2. âœ… æˆ–å·²ç»ä»¥ `pd.read_csv()` çš„æ–¹å¼å°†è¡¨æ ¼è¯»å…¥å†…å­˜ä¸­ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä¸ºæ‚¨ç¼–å†™ **ç¬¬ä¸€é˜¶æ®µçš„æ•°æ®æå–ä»£ç æ¡†æ¶**ï¼Œé€‚ç”¨äºä¸Šè¿°ä»»ä¸€æƒ…å†µã€‚

---

# ğŸ“ ç¬¬ä¸€é˜¶æ®µï¼šMIMIC-IV æ•°æ®æå–ï¼ˆçº¯ Python æ–¹å¼ï¼‰

## ğŸ¯ ç›®æ ‡ï¼šè·å– DKA æ‚£è€…åŸºæœ¬ä¿¡æ¯ä¸ ICU å…¥ç»„åˆ—è¡¨

---

## âœ… éœ€è¦çš„è¡¨æ ¼ï¼ˆCSVæˆ–DataFrameï¼‰

| æ–‡ä»¶åæˆ–å˜é‡å                                  | è¯´æ˜                |
| ---------------------------------------- | ----------------- |
| `patients.csv` / `patients_df`           | è·å–å¹´é¾„ã€æ€§åˆ«ç­‰          |
| `admissions.csv` / `admissions_df`       | è·å–å…¥é™¢æ—¶é—´            |
| `icustays.csv` / `icustays_df`           | ICUå…¥ç»„æ—¶é—´           |
| `diagnoses_icd.csv` / `diagnoses_icd_df` | ç”¨äºç­›é€‰ç³–å°¿ç—…é…®ç—‡é…¸ä¸­æ¯’ï¼ˆDKAï¼‰ |

---

## ğŸ“˜ Step 1ï¼šåŠ è½½åŸºç¡€æ•°æ®

```python
import pandas as pd

# å¯é€‰ï¼šæ›¿æ¢ä¸ºä½ è‡ªå·±çš„è·¯å¾„æˆ–åŠ è½½å·²æœ‰çš„ DataFrame
patients = pd.read_csv('mimiciv/patients.csv')
admissions = pd.read_csv('mimiciv/admissions.csv')
icustays = pd.read_csv('mimiciv/icustays.csv')
diagnoses_icd = pd.read_csv('mimiciv/diagnoses_icd.csv')
```

---

## ğŸ“˜ Step 2ï¼šç­›é€‰ DKA æ‚£è€…ï¼ˆICD-9/10ï¼‰

```python
# ICD-9/10 DKA ç¼–ç åˆ—è¡¨ï¼ˆå¯æ ¹æ®è®ºæ–‡æˆ–ç»éªŒè¡¥å……ï¼‰
dka_icd_codes = [
    # ICD-9
    '25010', '25011', '25012',
    # ICD-10
    'E1010', 'E1110', 'E1310'
]

# ICD codes å¯èƒ½æœ‰.æˆ–æ— .
diagnoses_icd['icd_clean'] = diagnoses_icd['icd_code'].str.replace('.', '', regex=False)

# é€‰å‡º DKA æ‚£è€…
dka_admissions = diagnoses_icd[
    diagnoses_icd['icd_clean'].isin(dka_icd_codes)
]['hadm_id'].unique()
```

---

## ğŸ“˜ Step 3ï¼šç­›é€‰ ICU æ‚£è€…ï¼ˆå…¥ç»„æ ·æœ¬ï¼‰

```python
# ç­›é€‰å…¥ICUçš„ DKA æ‚£è€…
dka_icustays = icustays[icustays['hadm_id'].isin(dka_admissions)]

# åˆå¹¶æ‚£è€…ä¿¡æ¯
dka_df = (
    dka_icustays
    .merge(admissions, on='hadm_id', how='left')
    .merge(patients, on='subject_id', how='left')
)

# è®¡ç®—å¹´é¾„
dka_df['age'] = pd.to_datetime(dka_df['intime']).dt.year - pd.to_datetime(dka_df['dob']).dt.year
dka_df = dka_df[dka_df['age'] >= 18]  # åªä¿ç•™æˆäºº

# æŸ¥çœ‹æ ·æœ¬æ•°é‡
print(f"âœ… å…±ç­›é€‰å‡º {len(dka_df)} å DKA + ICU æ‚£è€…")
```

---

## ğŸ”„ è¾“å‡ºç¤ºä¾‹ï¼ˆç¬¬ä¸€é˜¶æ®µå®Œæˆç»“æœï¼‰

```python
dka_df.head()[[
    'subject_id', 'hadm_id', 'stay_id',
    'gender', 'age', 'intime', 'outtime'
]]
```

---

## ğŸ“¦ ç¬¬ä¸€é˜¶æ®µè¾“å‡ºï¼š`dka_df`

è¯¥è¡¨ä½œä¸ºåç»­æå–ç‰¹å¾ï¼ˆå®éªŒå®¤å€¼ã€å°¿é‡ç­‰ï¼‰çš„**æ ¸å¿ƒæ ·æœ¬æ¸…å•**ï¼Œå°†ç”¨äºä¸‹ä¸€é˜¶æ®µï¼š

* æå–24å°æ—¶å†…çš„ `labevents` / `chartevents`ï¼›
* æ ‡è®°æ˜¯å¦å‘ç”Ÿ AKIï¼›
* æ„å»ºåˆ†ææ•°æ®é›†ã€‚

---

æ˜¯å¦ç°åœ¨ç»§ç»­è¿›å…¥ **ç¬¬äºŒé˜¶æ®µï¼šæ„å»º AKI æ ‡ç­¾ä¸æå–å®éªŒå®¤å˜é‡**ï¼Ÿå¦‚æœæ‚¨å·²ç»åŠ è½½äº† `labevents.csv` å’Œ `chartevents.csv`ï¼Œæˆ‘å¯ä»¥ç›´æ¥ç»§ç»­å†™ä»£ç ã€‚
