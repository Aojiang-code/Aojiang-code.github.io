éå¸¸å¥½ï¼Œæˆ‘ä»¬ç°åœ¨è¿›å…¥ï¼š

---

# ğŸ“ é˜¶æ®µå››ï¼šæå– ICU å…¥ç§‘å 24 å°æ—¶å†…çš„ç‰¹å¾å˜é‡ï¼ˆå®éªŒå®¤ + ç”Ÿå‘½ä½“å¾ + å¹²é¢„å˜é‡ï¼‰

ğŸ¯ **ç›®æ ‡**ï¼šä» `labevents` ä¸ `chartevents` è¡¨ä¸­ï¼ŒæŒ‰ç…§è®ºæ–‡æ–¹æ³•æå– ICU å…¥ç§‘å 24 å°æ—¶å†…çš„å…³é”®å˜é‡ï¼ŒåŒ…æ‹¬ï¼š

* ğŸ”¬ å®éªŒå®¤æŒ‡æ ‡ï¼ˆLabsï¼‰
* ğŸ’“ ç”Ÿå‘½ä½“å¾ï¼ˆVitalsï¼‰
* ğŸ’‰ å¹²é¢„å˜é‡ï¼ˆInterventionsï¼‰

å¹¶ä»¥ **stay\_id ä¸ºä¸»é”®ï¼Œä¸€è¡Œä¸€ä¸ªæ‚£è€…** æ„å»ºæœ€ç»ˆå»ºæ¨¡ç”¨çš„ç‰¹å¾è¡¨ã€‚

---

## âœ… ä¸€ã€æå–åŸåˆ™ï¼ˆä¸¥æ ¼éµå¾ªè®ºæ–‡ï¼‰

| åŸåˆ™   | è¯´æ˜                           |
| ---- | ---------------------------- |
| é‡‡é›†æ—¶é—´ | ICU å…¥ç§‘å 0\~24 å°æ—¶             |
| æ•°æ®å¤„ç† | å¤šæ¬¡è®°å½•å–**ç¬¬ä¸€æ¬¡è®°å½•å€¼**ï¼ˆfirst chartï¼‰ |
| å•ä½ç»Ÿä¸€ | ç»Ÿä¸€å˜é‡å‘½åä¸å•ä½ï¼ˆä¸æ–‡çŒ®ä¸€è‡´ï¼‰             |
| è¡¨è¾¾æ ¼å¼ | æ¯ä¸ªæ‚£è€…ä¸€è¡Œï¼Œåˆ—ä¸ºç‰¹å¾å˜é‡ï¼ˆåç»­ç”¨äºæœºå™¨å­¦ä¹ ï¼‰      |

---

## âœ… äºŒã€å˜é‡æå–æ¸…å•ï¼ˆæ ¹æ®è®ºæ–‡ï¼‰

### ğŸ“Š å®éªŒå®¤å˜é‡ï¼ˆ`labevents`ï¼‰

| ä¸­æ–‡åç§°  | è‹±æ–‡å       | ItemID |
| ----- | --------- | ------ |
| è¡€å°¿ç´ æ°®  | `BUN`     | 51006  |
| è‚Œé…    | `Scr`     | 50912  |
| è¡€é’     | `Na`      | 50983  |
| è¡€é’¾    | `K`       | 50971  |
| è¡€ç³–    | `Glucose` | 50931  |
| ç™½ç»†èƒ   | `WBC`     | 51301  |
| è¡€å°æ¿   | `PLT`     | 51265  |
| è¡€çº¢è›‹ç™½  | `Hb`      | 51222  |
| è¡€é’™    | `Ca`      | 50893  |
| æ°¯ç¦»å­   | `Cl`      | 50902  |
| é˜´ç¦»å­é—´éš™ | `AG`      | 50868  |
| ç£·é…¸ç›   | `Phos`    | 50970  |
| è¡€æ°”è¡€ç³–  | `BG`      | 50809  |

### â¤ï¸ ç”Ÿå‘½ä½“å¾å˜é‡ï¼ˆ`chartevents`ï¼‰

| ä¸­æ–‡åç§°  | è‹±æ–‡å           | ItemIDsï¼ˆä»»é€‰ä¸€ä¸ªï¼‰    |
| ----- | ------------- | ---------------- |
| å¿ƒç‡    | `HR`          | 211              |
| å‘¼å¸é¢‘ç‡  | `RR`          | 618              |
| æ”¶ç¼©å‹   | `SBP`         | 51               |
| èˆ’å¼ å‹   | `DBP`         | 8368             |
| ä½“é‡    | `Weight`      | 226512           |
| GCSæ€»åˆ† | `GCS`         | è‡ªè¡Œè®¡ç®—ï¼ˆè¯¦åï¼‰         |
| å°¿é‡    | `UrineOutput` | å¤šä¸ªå°¿é‡ itemid åˆå¹¶è®¡ç®— |

---

## âœ… ä¸‰ã€å®éªŒå®¤å˜é‡æå–ï¼ˆ`labevents` è¡¨ï¼‰

æˆ‘ä»¬ä¸€æ¬¡æ€§æå–æ‰€æœ‰ lab ç‰¹å¾ï¼ˆå¯æ‰©å±•å˜é‡ï¼‰ï¼š

```python
lab_itemids = {
    'BUN': 51006,
    'Scr': 50912,
    'Na': 50983,
    'K': 50971,
    'Glucose': 50931,
    'WBC': 51301,
    'PLT': 51265,
    'Hb': 51222,
    'Ca': 50893,
    'Cl': 50902,
    'AG': 50868,
    'Phos': 50970,
    'BG': 50809
}

# æ„é€  SQL æŸ¥è¯¢ï¼ˆå…¥ICUå24å°æ—¶å†…ï¼Œå–ç¬¬ä¸€æ¬¡è®°å½•ï¼‰
lab_queries = []
for var, itemid in lab_itemids.items():
    lab_queries.append(f"""
    SELECT stay_id, '{var}' AS variable, MIN(valuenum) AS value
    FROM labevents l
    INNER JOIN dka_with_aki d ON l.hadm_id = d.hadm_id
    WHERE l.itemid = {itemid}
      AND l.charttime BETWEEN d.intime AND d.intime + INTERVAL 24 HOUR
    GROUP BY stay_id
    """)

# åˆå¹¶æ‰€æœ‰æŸ¥è¯¢ï¼ˆUNION ALLï¼‰
full_lab_query = " UNION ALL ".join(lab_queries)

lab_features_df = con.execute(full_lab_query).df()
```

### âœ… é€è§†åŒ–ï¼ˆpivotï¼‰å¾—åˆ°ä¸€è¡Œä¸€ä¸ªæ‚£è€…çš„è¡¨ï¼š

```python
lab_pivot = lab_features_df.pivot(index='stay_id', columns='variable', values='value').reset_index()
```

---

## âœ… å››ã€ç”Ÿå‘½ä½“å¾æå–ï¼ˆ`chartevents` è¡¨ï¼‰

### ç¤ºä¾‹ï¼šæå– HRã€RRã€SBPã€DBPã€ä½“é‡

```python
vital_itemids = {
    'HR': 211,
    'RR': 618,
    'SBP': 51,
    'DBP': 8368,
    'Weight': 226512
}

vital_queries = []
for var, itemid in vital_itemids.items():
    vital_queries.append(f"""
    SELECT stay_id, '{var}' AS variable, MIN(valuenum) AS value
    FROM chartevents c
    INNER JOIN dka_with_aki d ON c.stay_id = d.stay_id
    WHERE c.itemid = {itemid}
      AND c.charttime BETWEEN d.intime AND d.intime + INTERVAL 24 HOUR
    GROUP BY stay_id
    """)

full_vital_query = " UNION ALL ".join(vital_queries)
vital_features_df = con.execute(full_vital_query).df()
vital_pivot = vital_features_df.pivot(index='stay_id', columns='variable', values='value').reset_index()
```

---

## âœ… äº”ã€åˆå¹¶ lab + vital + AKI æ ‡ç­¾ä¸ºæ€»è¡¨

```python
# è·å– cohort åŸºç¡€ä¿¡æ¯ï¼ˆå« AKI æ ‡ç­¾ï¼‰
cohort_df = con.execute("SELECT stay_id, subject_id, hadm_id, age, gender, aki_label FROM dka_with_aki").df()

# åˆå¹¶æ‰€æœ‰å˜é‡
full_features = cohort_df.merge(lab_pivot, on='stay_id', how='left')
full_features = full_features.merge(vital_pivot, on='stay_id', how='left')
```

---

## âœ… å…­ã€æŸ¥çœ‹ç»“æœ

```python
# é¢„è§ˆæ ·æœ¬å’Œç‰¹å¾
print(full_features.shape)
full_features.head()

# æ£€æŸ¥ç¼ºå¤±æ¯”ä¾‹
missing_pct = full_features.isnull().mean().sort_values(ascending=False)
print(missing_pct)
```

---

## âœ… é˜¶æ®µå››æˆæœæ€»ç»“

| å†…å®¹                 | è¯´æ˜                          |
| ------------------ | --------------------------- |
| ğŸ“„ `full_features` | æ¯åæ‚£è€…ä¸€è¡Œï¼ŒåŒ…å« AKI æ ‡ç­¾ä¸ 20+ ä¸ªç‰¹å¾å˜é‡ |
| âœ… å¯ç”¨äºå»ºæ¨¡            | ä¸‹ä¸€é˜¶æ®µå¯ç›´æ¥è¿›è¡Œç¼ºå¤±å€¼å¤„ç†ä¸è®­ç»ƒé›†åˆ’åˆ†        |

---

æ˜¯å¦ç»§ç»­è¿›å…¥ï¼š

### ğŸ“ é˜¶æ®µäº”ï¼šç¼ºå¤±å¤„ç† + ç‰¹å¾æ ‡å‡†åŒ– + è®­ç»ƒé›†åˆ’åˆ†ï¼Ÿ

æˆ‘å°†æä¾›ç”¨äº LASSO ç‰¹å¾é€‰æ‹©ä¸ 8 ç§æ¨¡å‹è®­ç»ƒçš„å®Œæ•´æ•°æ®å‡†å¤‡ä»£ç ã€‚å‡†å¤‡å¥½äº†å—ï¼Ÿ
