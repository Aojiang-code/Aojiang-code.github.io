## 3.1数据的预处理
1. 数据审核
2. 数据筛选
3. 数据排序

> 数据审核 :检查数据中是否有错误
>> ==直接数据== :
>>> **完整性** :应调查的个体是否有遗漏,所调查项目是否填写齐全
>>> **准确性** :数据是否有错误,是否存在异常值
>>==间接数据== :
>>>**适用性** :数据来源,数据口径,背景材料
>>>**时效性**
>
>数据筛选 :根据需要找出符合条件的数据
>数据排序 :事实上数据排序更多的目的还是为了更方便地发现异常值，是做数据清洗的手段

## 3.2数据的整理与展示
> 这部分的数据整理是在预处理完毕后，根据我们需要对数据进行整理和简单可视化（多画图，多可视化，你能发现很多事情）。
> 
> 那么第一步就是先把我们的数据类型搞清楚。因为不同类型数据，整理方式不同。
- 对于分类数据和顺序数据主要是做分类整理。
- 对于数值数据主要是做分组整理。


### 3.2.1分类数据的整理与展示
> 分类数据的整理核心就是计算频数、比例、百分比、比率，一般可视化用条形图（柱状图）。此外还可以考虑使用帕累托图。

> 分类数据的整理与展示分四步:
1. 列出所分的类别
2. 计算每一类别的频数、频率或比例、比率
3. 制作频数分布表
4. 选择合适的图形展示
---
1. 分类数据的整理
- 列出所分的类别
- 计算每一类别的频数、频率或比例、比率
- 制作频数分布表
2. 分类数据的图示
> 条形图与帕累托图
>> 条形图
>> 帕累托图 :
>> >帕累托图（Pareto chart）是以意大利经济学家V.Pareto的名字而命名的。这是一个双坐标轴图，一侧纵坐标是频率，另一侧纵坐标是累计频率。是在条形图基础上加上一条折线图（累计频率曲线）。
>> >该图是按各类别出现的频数多少排序后绘制的条形图.通过对条形的排序,容易看出哪类数据出现的多,哪类数据出现的少.
>> >通常用帕累托图来表示，就是研究事物特征是否存在二八定律（20/80规律，典型案例：20%的人拥有80%的财富）。
>
>-   顺序数据则一般选用累计频率曲线和环状图进行可视化。
> 饼图和环形图
>> 饼图
>> 环形图
### 3.2.2数值数据的整理与展示
1. 数据分组
- 这里面有一个直方图分组使用的经验公式。
- $K=1+\frac{lg^{n}}{lg^{2}}$
- K为组数，n为样本数。确定组数后，通过极差和组数求组距即可分组。
2. 数值数据的图示
> 直方图
> 箱形图
> 散点图
> 雷达图
## 3.4合理使用图表
1. 简洁
2. 比例4：3
3. 编号与标题

## 数据可视化的R语言实现
常言道，一图胜千言。数据可视化能够简化数据的复杂性，把繁杂的数据中蕴含的关系用人们易于理解的方式展现出来。

数据可视化旨在借助图形化手段，清晰有效地传达与沟通信息。

本节分为3个部分：
- 首先介绍用R的基础绘图系统作图；
- 然后介绍怎样用当前流行的ggplot2包完成数据可视化的任务；
- 最后介绍一些比较特殊而又实用的图形的绘制方法。

### 用R的基础绘图系统作图
R的基础绘图系统由Roos Ihaka编写，功能非常强大，主要由graphics包和grDevices包组成，它们在启动R时会自动加载。
基础绘图系统有两类函数：
- 一类是高水平作图函数，所谓高水平函数是用于直接产生图形的函数，包括plot()、hist()、boxplot()和pairs()等
- 另一类是低水平作图函数，低水平函数是用于在高水平作图函数所绘制图形的基础上添加新的图形或元素的函数，包括points()、lines()、text()、title()、legend()和axis()等。
#### 函数plot()
函数plot()是一个泛型函数，对不同类型的数据，它可以绘制出不同的图形。
例如：
- 对于一些数值型数据，它可以绘制出散点图
- 对于分类数据，它可以绘制出箱线图
- 对于一些统计模型，它可以绘制出相应的图形，比如生存分析，它可以绘制出生存曲线
因此，函数plot()的使用频率非常高，建议各位打开它的帮助文档查看其各种常用参数的用法。

下面创建一个示例数据，表示某病病人对2种药物（drungA和drungB）、5个剂量（dose）水平上的响应情况：
```r
dose <- c(20, 30, 40, 45, 60)

drugA <- c(16, 20, 27, 40, 60)

drugB <- c(15, 18, 25, 31, 40)
```

用上面的数据绘制药物A的剂量和响应关系的图形：
```r
plot(dose, drugA)

plot(dose, drugA, type = "b")
```

![[Pasted image 20230830224543.png|350]]
![[Pasted image 20230830224616.png|350]]

上面的命令创建了两幅图，函数plot()里的参数type默认为“p”(代表点point)，所以得到的图是散点图。
在第二行的命令里，参数type改成了“b”(代表点和线)，所以得到的图是点线图。

函数plot()用于新建一幅图形，我们还可以用低水平作图函数，例如ines()、legend()等，在一幅现有的图形上添加新的图形元素。例如：
```r
plot(dose, drugA, type = "b",#指定绘制药物A

         xlab = "Dosage",ylab = "Response",#绘制x轴和y轴上的标签

        lty = 1, pch = 15)#绘制线和点

lines(dose, drugB, type = "b", lty = 2, pch = 17)#指定绘制药物A，绘制线和点

legend("topleft", title = "Drug Type",#添加图例，"topleft"代表图例的位置为左上角，title = "Drug Type"代表图例的名称为Drug Type

       legend = c("A", "B"),#添加图例文字

       lty = c(1, 2),#指定图例中线的类型

       pch = c(15, 17))#指定图例中点的类型
```

![[Pasted image 20230830225727.png|350]]

如上图所示，为了比较两种不同剂量下的响应情况，我们在一幅图上展示了两个点线图，并用不同类型的线（lty）和不同特征的点（pch）加以区分。为了增强可读性，还添加了图例（legend）。
> 需要注意的是，函数legend()里面的点和线的属性必须与前面函数plot()和line()中设置的属性一致。

### 直方图和密度曲线图
直方图（histogram）是用于展示连续型变量分布的最常用的工具，它本质上是对密度函数的一种估计。直方图和密度曲线图一般用于探索分布，很少用于报告结果。函数hist()可直接绘制直方图。
#### 函数hist()的使用方法
在R语言中，`hist()`函数用于绘制直方图。直方图是一种用来显示数据分布情况的图形。以下是`hist()`函数的常见用法：
基本语法：
`hist(x, ...)`
参数说明：
-   `x`：要绘制直方图的数据，可以是向量、矩阵或数据框。
-   `...`：其他参数，用于控制直方图的绘制细节，例如颜色、边界、标题等。
示例1：
```r
# 创建一个向量 
x <- c(2, 5, 4, 3, 2, 1, 3, 2, 5, 4, 5) 
# 绘制直方图 
hist(x)
```
结果是绘制了一个直方图，x轴表示数据的取值范围，y轴表示频数。

示例2：
```r
# 创建一个随机生成的数据框 
df <- data.frame(   A = rnorm(1000),   B = rnorm(1000) )  

# 绘制数据框中每列的直方图 
par(mfrow=c(2,1))  # 将图形分为2行1列 

hist(df$A, col = "blue")  # 绘制A列的直方图 

hist(df$B, col = "red")  # 绘制B列的直方图
```

结果是绘制了两个直方图，上面的直方图表示数据框中A列的分布，下面的直方图表示数据框中B列的分布。

`hist()`函数还有其他一些可选参数，比如：
-   `breaks`：指定直方图的分组边界。
-   `main`：设置直方图的标题。
-   `xlab`：设置x轴的标签。
-   `ylab`：设置y轴的标签。
-   `col`：设置直方图的颜色。
-   `border`：设置直方图的边界颜色。





#### 绘制直方图和密度曲线图
数据集anorxia位于MASS包中，其变量Treat(治疗方式)是一个包含3个水平的因子，变量Prew和Postwt均为数值型，分别表示治疗前后的体重（单位：lb）。下面绘制变量Prewt的直方图：
```r
r$> library(MASS)

r$> data(anorexia)

r$> str(anorexia)
'data.frame':   72 obs. of  3 variables:
 $ Treat : Factor w/ 3 levels "CBT","Cont","FT": 2 2 2 2 2 2 2 2 2 2 ...
 $ Prewt : num  80.7 89.4 91.8 74 78.1 88.3 87.3 75.1 80.6 78.4 ...  
 $ Postwt: num  80.2 80.1 86.4 86.3 76.1 78.1 75.1 86.7 73.5 84.6 ...
```

```r
attach(anorexia)
hist(Prewt)
```
![[Pasted image 20230830232508.png|350]]

> 失去一切过后，不要失去自己，背井离乡和锲而不舍的努力只为出人头地。
> 与天斗，与人斗，与命运斗。
> 虎伏深山听风啸，龙卧浅滩等海潮！

上图给出了变量Prewt的频数分布，由于函数hist()中没有设置任何参数，图中使用了默认的组距、坐标轴标签和标题等。需要注意的是，直方图的形状受到组距的影响，有时我们需要尝试设定参数 breaks的不同的值以得到合适的图形。函数hist()的输出结果中包含一些计算返回值，这些值可用于进一步地作图或者分析，例如为区间划分端点、频数（或密度）、区间中点等。
　　密度曲线为数据的分布提供了一种更为平滑的描述，绘制密度曲线的方法为：
```r
plot(density(Prewt))
```

![[Pasted image 20230831094117.png|350]]

从上图可以看出,变量Prewt的分布是单峰的,基本是对称的。我们还可以在一幅直方图上添加一条密度曲线和轴须图。此时，需要在函数hist()里面设定参数 freq为FALSE,即把纵坐标换成频率（而不是频数，如果设置为TURE则显示为频数），否则将会几乎看不到密度曲线参数las设为1是为了将纵轴的刻度标签横显示。

> 在R语言中，`hist()`函数用于绘制直方图。参数`freq`用于控制绘制直方图时是否显示频数。当`freq`设置为`FALSE`时，表示不显示频数，而是显示相对频率（频率的比例）。可以通过将频数除以总数来计算相对频率。

```r
# 绘制直方图 
hist(Prewt, freq = FALSE, col = "red", xlab = "体重(lbs)", main = "治疗前体重分布直方图", las = 1) 

# 添加核密度曲线 
lines(density(Prewt), col = "blue", lwd = 2) 

# 添加刻度线 
rug(Prewt) 

# 从数据框anorexia中删除变量
Prewt detach(anorexia)

```

![[Pasted image 20230831094620.png]]

上面代码的功能是将变量`Prewt`的分布情况以直方图的形式显示出来，并添加核密度曲线和刻度线。直方图的参数设置如下：
-   `freq = FALSE`：指定y轴显示的是密度而不是频数。
-   `col = "red"`：设置直方图的颜色为红色。
-   `xlab = "体重(lbs)"`：设置x轴的标签为"体重(lbs)"。
-   `main = "治疗前体重分布直方图"`：设置直方图的标题为"治疗前体重分布直方图"。
-   `las = 1`：旋转x轴刻度标签为水平方向。

然后使用`lines()`函数添加核密度曲线，使用`density()`函数计算变量`Prewt`的核密度估计。`col = "blue"`设置曲线的颜色为蓝色，`lwd = 2`设置曲线的粗细为2。
最后使用`rug()`函数在直方图下方添加刻度线，以显示每个观测点的位置。
代码最后使用`detach(anorexia)`将数据框`anorexia`中的变量`Prewt`从工作环境中删除。

上图使用红色填充了条形,添加了信息量更大的坐标轴标签和标题,还通过设置参数las为1把纵轴的刻度标签换成了横向显示。然后用数lines()在直方图上叠加了一条蓝色的、两倍于默认线条宽度的密度曲线。最后使用函数rug()在横轴上添加了轴须图,以展示数分布的集趋势。

```r
library(MASS)# 加载MASS包

data(anorexia)# 加载anorexia数据集

str(anorexia)# 查看anorexia数据集的结构

attach(anorexia)# 将anorexia数据集附加到工作环境中

par(mfrow = c(1, 3))# 设置图形参数为1行3列的布局

hist(Prewt)# 绘制Prewt的直方图

plot(density(Prewt))# 绘制Prewt的密度估计图

# 绘制Prewt的直方图，并添加核密度曲线和刻度线
hist(Prewt, freq = FALSE, col = "red",

     xlab = "体重(lbs)",

     main = "治疗前体重分布直方图",

     las = 1)#用`hist()`函数绘制直方图，通过设置`freq = FALSE`来将y轴显示为密度而不是频数。我们使用`col = "red"`设置直方图的颜色为红色，`xlab = "体重(lbs)"`设置x轴标签为"体重(lbs)"，`main = "治疗前体重分布直方图"`设置标题为"治疗前体重分布直方图"，`las = 1`旋转x轴刻度标签为水平方向,las设置为1，表示标签从左向右旋转90度，也就是正交于y轴

lines(density(Prewt), col = "blue", lwd = 2)#使用`lines()`函数添加了Prewt变量的核密度估计曲线，使用`col = "blue"`将曲线的颜色设置为蓝色，`lwd = 2`将曲线的宽度设置为2

rug(Prewt)#使用`rug()`函数在直方图底部添加刻度线，显示每个观测点的位置

detach(anorexia)#使用`detach(anorexia)`从工作环境中删除anorexia数据集，以防止变量冲突或误用。
par(mfrow = c(1, 1))
```

![[Pasted image 20230831100557.png]]


### 条形图
条形图（bar chart）在医学科技论文中经常用到，它通过垂直的或水平的矩形展示分类变量的频数分布。函数barplot()可用于绘制条形图。下面以yed包里的Arthritis数据集为例介绍函数 barplot()的用法。该数据集来自一项关于治疗类风湿性关节炎新方法的成组对照双盲临床试验研究。其中的反应变量Improved 记录了每位接受药物治疗（Treated，41例)或安慰剂(Placebo,43例)的患者的治疗效果，为3个级(None、Some、Marked)。
```r
#install.packages(pkgs="vcd")

library(vcd)

data(Arthritis)

attach(Arthritis)

counts <- table(Improved)

counts

r$> counts
Improved
  None   Some Marked
    42     14     28
```

函数table()用于生成分类变量的频数统计表。从上面的输出可以看到，有28位患者有了明显改善、14人有部分改善，而有42人没有改善。条形图可以用于展示这个频数分布，如下图所示：

```r
barplot(counts, xlab = "Improvement", ylab = "Freqency", las = 1)#las设置为1，表示标签从左向右旋转90度，也就是正交于y轴
```

![[Pasted image 20230831103227.png]]

函数 barplot()还可以用于展示二维列联表的数据，代码如下：
```r
counts <- table(Improved, Treatment)

barplot(counts,

        col = c("red", "yellow", "green"),

        xlab = "Improvement",

        ylab = "Freqency",

        beside = TRUE, las = 1)# 使用barplot函数生成并列条形图，设置条形的颜色为红色、￥￥、绿色，x轴标题为"Improvement"，y轴标题为"Frequency"，beside参数设置为TRUE以显示并列条形图，las参数设置为1以让x轴刻度标签水平显示。

legend("top", legend = rownames(counts),

       fill = c("red", "yellow", "green"))#使用legend函数在图的顶部添加图例，图例内容为各组合的行名，颜色与条形图相对应。
```

